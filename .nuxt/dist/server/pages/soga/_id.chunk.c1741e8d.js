exports.ids=[48],exports.modules={233:function(t,e){},234:function(t,e){},235:function(t,e){},236:function(t,e){},237:function(t,e){},238:function(t,e){},241:function(t,e,n){"use strict";var o={name:"CommentReplyForm",props:{type:{required:!0,type:String},id:{required:!0,type:Number},toUserId:{required:!0,type:Number},value:{type:Boolean,default:!1,required:!0}},data(){return{open:this.value,submitting:!1,content:""}},mounted(){this.$watch("value",t=>{this.open=t,t&&this.$nextTick(()=>{this.$refs.input.focus()})}),this.$watch("open",t=>{this.$emit("input",t)})},methods:{cancel(){this.open=!1},async submit(){if(this.$store.state.login){if(this.content&&!this.submitting){this.submitting=!0;try{const t=await this.$store.dispatch("comment/createSubComment",{id:this.id,ctx:this,type:this.type,content:this.content,targetUserId:this.toUserId});this.open=!1,this.content="",this.$toast.success(t.message),this.$store.commit("UPDATE_USER_EXP",t.exp)}catch(t){}finally{this.submitting=!1}}}else this.$channel.$emit("sign-in")}}},r=n(0);var component=Object(r.a)(o,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.open?n("div",{staticClass:"comment-reply-form"},[t._ssrNode('<div class="btn-group">',"</div>",[n("el-button",{attrs:{size:"mini",type:"info",plain:""},on:{click:t.cancel}},[t._v("\n      取消\n    ")]),t._ssrNode(" "),n("el-button",{attrs:{loading:t.submitting,size:"mini",type:"primary"},on:{click:t.submit}},[t._v("\n      发表\n    ")])],2),t._ssrNode(' <div class="input-wrap"><input type="text" placeholder="请缩减至100字以内" maxlength="100"'+t._ssrAttr("value",t.content)+"></div>")],2):t._e()},[],!1,function(t){var e=n(249);e.__inject__&&e.__inject__(t)},null,"f8f6afc8");e.a=component.exports},243:function(t,e){},247:function(t,e,n){"use strict";var o=n(241),r={name:"VSubCommentItem",components:{CommentReplyForm:o.a},props:{comment:{required:!0,type:Object},parentUserId:{required:!0,type:Number},type:{required:!0,type:String,default:""}},data:()=>({showReplyArea:!1,deleting:!1}),computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},isMine(){return this.currentUserId===this.comment.from_user_id},canDelete(){return this.isMine||this.currentUserId===this.parentUserId},focusThisComment(){return parseInt(this.$route.query["reply-id"])===this.comment.id}},methods:{openReplyForm(){this.currentUserId?this.showReplyArea=!this.showReplyArea:this.$channel.$emit("sign-in")},deleteComment(){this.deleting||(this.deleting=!0,this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.dispatch("comment/deleteSubComment",{ctx:this,type:this.type,id:this.comment.id,parentId:this.comment.parent_id})}).catch(t=>{this.deleting=!1,"cancel"!==t&&this.$toast.error(t)}))}}},c=n(0);var l={name:"VSubCommentList",components:{SubCommentItem:Object(c.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sub-comment-item",class:{"focused-sub-comment":t.focusThisComment},attrs:{id:"sub-comment-"+t.comment.id}},[t._ssrNode('<div class="sub-user">',"</div>",[t._ssrNode('<div class="avatar">',"</div>",[n("user-card",{attrs:{id:t.comment.from_user_id,zone:t.comment.from_user_zone}},[n("v-img",{attrs:{src:t.comment.from_user_avatar,avatar:!0,width:24,height:24}})],1)],1)]),t._ssrNode(" "),t._ssrNode('<div class="sub-body">',"</div>",[n("user-card",{attrs:{id:t.comment.from_user_id,zone:t.comment.from_user_zone,"custom-class":"from-user href-fade-blue"}},[t._v("\n      "+t._s(t.comment.from_user_name)+"\n    ")]),t._ssrNode(" "),t._ssrNode('<span class="sub-text">',"</span>",[t.comment.to_user_id&&t.comment.to_user_id!==t.parentUserId?[t._ssrNode("\n        回复\n        "),n("user-card",{attrs:{id:t.comment.to_user_id,zone:t.comment.to_user_zone,"custom-class":"to-user"}},[t._v("\n          @"+t._s(t.comment.to_user_name)+"\n        ")])]:t._e(),t._ssrNode(t._ssrEscape("\n      "+t._s(t.comment.content)+"\n    "))],2),t._ssrNode(" "),t._ssrNode('<div class="sub-extra">',"</div>",[n("el-tooltip",{attrs:{content:t.comment.created_at,placement:"top",effect:"dark"}},[n("v-time",{model:{value:t.comment.created_at,callback:function(e){t.$set(t.comment,"created_at",e)},expression:"comment.created_at"}})],1),t._ssrNode(' <button class="reply-btn">\n        回复\n      </button> '),t.canDelete?t._ssrNode("<button>","</button>",[t._ssrNode('<i class="iconfont icon-shanchu"></i>')],2):n("report-dialog",{attrs:{id:t.comment.id,type:t.type+"_reply"}},[n("button",{staticClass:"reply-btn"},[t._v("\n          举报\n        ")])])],2),t._ssrNode(" "),n("comment-reply-form",{attrs:{id:t.comment.parent_id,type:t.type,"to-user-id":t.comment.from_user_id},model:{value:t.showReplyArea,callback:function(e){t.showReplyArea=e},expression:"showReplyArea"}})],2)],2)},[],!1,function(t){var e=n(250);e.__inject__&&e.__inject__(t)},null,"984d8742").exports},props:{parentComment:{required:!0,type:Object},type:{required:!0,type:String,default:""}},data:()=>({loading:!1,showCollapse:!1,collapsed:!1}),computed:{comments(){return this.parentComment.comments},authorId(){return this.parentComment.from_user_id},filterComments(){if(!this.collapsed)return this.comments.list;const data=this.comments,t=data.list,e=t.slice(0,5);if(t.every(t=>t.id<=data.maxId))return e;const n=e.map(t=>t.id);return e.concat(t.filter(t=>t.id>data.maxId&&-1===n.indexOf(t.id)))}},methods:{async loadMore(){if(!this.loading){this.loading=!0;try{await this.$store.dispatch("comment/getSubComments",{ctx:this,type:this.type,id:this.parentComment.id}),this.showCollapse=!0}catch(t){}finally{this.loading=!1}}}}};var d={name:"VCommentItem",components:{SubCommentList:Object(c.a)(l,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sub-comment-list-wrap"},[t._l(t.filterComments,function(e){return n("sub-comment-item",{key:e.id,attrs:{comment:e,"parent-user-id":t.authorId,type:t.type}})}),t._ssrNode(" "+(!t.comments.noMore||t.comments.list.length>5?'<div class="view-more">\n    共<strong>'+t._ssrEscape(t._s(t.comments.total))+"</strong>条回复\n    "+(t.comments.noMore?"\x3c!----\x3e":'\n      ，\n      <button class="more-btn">\n        查看更多\n      </button>')+" "+(t.showCollapse?'<button class="collapse-btn">'+t._ssrEscape("\n      "+t._s(t.collapsed?"展开":"收起")+"\n    ")+"</button>":"\x3c!----\x3e")+"</div>":"\x3c!----\x3e"))],2)},[],!1,function(t){var e=n(251);e.__inject__&&e.__inject__(t)},null,"8442972c").exports,CommentReplyForm:o.a},props:{comment:{required:!0,type:Object},masterId:{required:!0,type:[Number,String]},type:{required:!0,type:String,default:""}},data:()=>({deleting:!1,liking:!1,showReplyArea:!1}),computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},authorId(){return this.comment.from_user_id},isMine(){return this.currentUserId===this.authorId},canDelete(){return this.isMine||this.currentUserId===this.masterId},focusThisComment(){return parseInt(this.$route.query["comment-id"])===this.comment.id}},methods:{async toggleLike(){if(this.currentUserId){if(!this.liking){this.liking=!0;try{await this.$store.dispatch("comment/toggleLikeMainComment",{ctx:this,type:this.type,id:this.comment.id})}catch(t){}finally{this.liking=!1}}}else this.$channel.$emit("sign-in")},deleteComment(){this.deleting||(this.deleting=!0,this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.dispatch("comment/deleteMainComment",{ctx:this,type:this.type,id:this.comment.id}),this.$emit("delete")}).catch(t=>{this.deleting=!1,"cancel"!==t&&this.$toast.error(t)}))},replyComment(){this.currentUserId?this.showReplyArea=!this.showReplyArea:this.$channel.$emit("sign-in")}}};var m=Object(c.a)(d,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"def-comment-item",class:{"focused-main-comment":t.focusThisComment},attrs:{id:"comment-"+t.comment.id}},[t._ssrNode('<div class="user">',"</div>",[n("user-card",{attrs:{id:t.comment.from_user_id,zone:t.comment.from_user_zone}},[n("v-img",{staticClass:"avatar",attrs:{src:t.comment.from_user_avatar,avatar:!0,width:48,height:48}})],1)],1),t._ssrNode(" "),t._ssrNode('<div class="body">',"</div>",[t._ssrNode('<div class="header">',"</div>",[t._ssrNode("<a"+t._ssrAttr("href",t.$alias.user(t.comment.from_user_zone))+' target="_blank" class="blue-link">'+t._ssrEscape(t._s(t.comment.from_user_name))+"</a> "+(t.comment.is_owner?"<span>(楼主)</span>":"\x3c!----\x3e")+" "),t.comment.is_leader?n("el-tooltip",{attrs:{placement:"top",effect:"dark",content:"版主"}},[n("i",{staticClass:"iconfont icon-leader"})]):t.comment.is_master?n("el-tooltip",{attrs:{placement:"top",effect:"dark",content:"代行者"}},[n("i",{staticClass:"iconfont icon-master"})]):t._e()],2),t._ssrNode(' <div class="content">'+t._s(t.comment.content)+"</div> "),t._ssrNode('<div class="footer">',"</div>",[t._ssrNode('<span class="floor-count">'+t._ssrEscape("#"+t._s(t.comment.floor_count-1))+"</span> "),n("el-tooltip",{attrs:{content:t.comment.created_at,placement:"top",effect:"dark"}},[n("v-time",{attrs:{datetime:t.comment.created_at}})],1),t._ssrNode(' <button class="like-btn"><i'+t._ssrClass("iconfont",[t.comment.liked?"icon-dianzan-active":"icon-dianzan"])+"></i> "+(t.comment.like_count?"<span>"+t._ssrEscape(t._s(t.comment.like_count))+"</span>":"\x3c!----\x3e")+'</button> <button class="reply-btn">\n        回复\n      </button> '),t.canDelete?t._ssrNode('<button class="delete-btn">',"</button>",[t._ssrNode('<i class="iconfont icon-shanchu"></i>')],2):n("report-dialog",{attrs:{id:t.comment.id,type:t.type+"_comment"}},[n("button",{staticClass:"reply-btn main-comment-report-btn"},[t._v("\n          举报\n        ")])])],2),t._ssrNode(" "),n("comment-reply-form",{attrs:{id:t.comment.id,"to-user-id":t.authorId,type:t.type},model:{value:t.showReplyArea,callback:function(e){t.showReplyArea=e},expression:"showReplyArea"}}),t._ssrNode(" "),n("sub-comment-list",{attrs:{"parent-comment":t.comment,type:t.type}})],2)],2)},[],!1,function(t){var e=n(252);e.__inject__&&e.__inject__(t)},null,"8deb9696").exports,h={name:"CreateCommentForm",props:{type:{type:String,required:!0},id:{type:[Number,String],required:!0},masterId:{type:Number,required:!0}},data:()=>({content:""}),computed:{isGuest(){return!this.$store.state.login},submitting(){return this.$store.state.comment.submitting},userAvatar(){return this.isGuest?"https://image.calibur.tv/default/user-avatar":this.$store.state.user.avatar}},methods:{async submit(){if(this.isGuest)return this.$toast.info("继续操作前请先登录"),void this.$channel.$emit("sign-in");if(this.content&&!this.submitting){this.$store.commit("comment/SET_SUBMITTING",{result:!0});try{const t=await this.$store.dispatch("comment/createMainComment",{content:this.content,images:[],type:this.type,id:this.id,ctx:this});this.content="",this.withImage&&this.$refs.uploader.clearFiles(),this.$toast.success(t.message),this.$store.commit("UPDATE_USER_EXP",t.exp),window.__closeImageLazy__||setTimeout(()=>{const e=document.getElementById(`comment-${t.data.id}`);e&&this.$scrollToY(this.$utils.getOffsetTop(e)-200,600)},400),this.$emit("submit")}catch(t){}finally{this.$store.commit("comment/SET_SUBMITTING",{result:!1})}}},handleTextAreaFocus(){this.isGuest&&this.$channel.$emit("sign-in")}}};var _={name:"CommentMain",components:{CommentCreateForm:Object(c.a)(h,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"create-comment-form"},[e("v-img",{staticClass:"avatar",attrs:{src:this.userAvatar,width:48,height:48,avatar:!0}}),this._ssrNode(' <div class="main-area"><button class="submit-btn">\n      发表<br>评论\n    </button> <div class="text-wrap"><textarea placeholder="请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。" maxlength="1000"></textarea></div></div>')],2)},[],!1,function(t){var e=n(253);e.__inject__&&e.__inject__(t)},null,"0c39bf82").exports,CommentItem:m},props:{id:{required:!0,type:[Number,String]},type:{required:!0,type:String,validator:t=>~["post","video","image","score","question","answer","role"].indexOf(t)},onlySeeMaster:{type:Boolean,default:!1},masterId:{type:[Number,String],required:!0},emptyText:{type:String,default:"暂无评论，快来抢沙发吧╮(￣▽￣)╭！"},auto:{type:Boolean,default:!1},lazy:{type:Boolean,default:!1},showHeader:{type:Boolean,default:!0}},data:()=>({loading:!1}),computed:{store(){return this.$store.state.comment},list(){return this.store.list},noMore(){return this.store.noMore},total(){return this.store.total}},mounted(){this.auto&&this.$channel.$on(`fire-load-comment-${this.type}-${this.id}`,()=>{this.loadMore(!0)}),this.lazyLoadComment()},methods:{async loadMore(t=!1){if(!this.loading){this.loading=!0;try{await this.$store.dispatch("comment/getMainComments",{ctx:this,type:this.type,id:this.id,onlySeeMaster:this.onlySeeMaster?1:0,firstRequest:t})}catch(t){}finally{this.loading=!1}}},async lazyLoadComment(){if(!this.lazy)return void this.$nextTick(()=>{this.scrollToReply()});const{query:t}=this.$route;await this.$store.dispatch("comment/getMainComments",{id:this.id,type:this.type,seeReplyId:t["comment-id"],onlySeeMaster:t.only&&parseInt(t.only,10)?1:0}),this.$nextTick(()=>{this.scrollToReply()})},scrollToReply(){const t=this.$route.query["comment-id"];if(!t)return;const e=document.getElementById(`comment-${t}`);e&&this.$nextTick(()=>{this.$scrollToY(this.$utils.getOffsetTop(e)-200,400)})}}};var f=Object(c.a)(_,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"comment-wrap"}},[t._t("header",[t.showHeader?n("h3",{staticClass:"sub-title"},[t._v("\n      评论"+t._s(t.total?"("+t.total+")":"")+"\n    ")]):t._e(),t._v(" "),n("comment-create-form",{attrs:{id:t.id,type:t.type,"master-id":t.masterId},on:{submit:function(e){return t.$emit("create-main-comment")}}})]),t._ssrNode(" "),t.list.length?t._ssrNode('<div id="comment-list-wrap">',"</div>",t._l(t.list,function(e){return t._ssrNode('<div class="comment-item-wrap">',"</div>",[t._t("comment-item",[n("comment-item",{attrs:{comment:e,type:t.type,"master-id":t.masterId},on:{delete:function(e){return t.$emit("delete-main-comment")}}})],{comment:e})],2)}),0):t.emptyText?t._ssrNode('<p class="no-content">'+t._ssrEscape(t._s(t.emptyText))+"</p>"):t._e(),t._ssrNode(" "),t._ssrNode('<div id="comment-list-footer">',"</div>",[t._ssrNode('<div class="load-more-btn">',"</div>",[t.noMore?t._e():n("el-button",{attrs:{loading:t.loading,type:"info",plain:"",round:""},on:{click:function(e){return t.loadMore(!1)}}},[t._v("\n        "+t._s(t.loading?"加载中...":"加载更多")+"\n      ")])],1),t._ssrNode(" "),t._t("reply",[t.list.length>=10?n("comment-create-form",{attrs:{id:t.id,type:t.type,"master-id":t.masterId},on:{submit:function(e){return t.$emit("create-main-comment")}}}):t._e()])],2)],2)},[],!1,function(t){var e=n(254);e.__inject__&&e.__inject__(t)},null,"7259fc5b");e.a=f.exports},249:function(t,e,n){"use strict";n.r(e);var o=n(233),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},250:function(t,e,n){"use strict";n.r(e);var o=n(234),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},251:function(t,e,n){"use strict";n.r(e);var o=n(235),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},252:function(t,e,n){"use strict";n.r(e);var o=n(236),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},253:function(t,e,n){"use strict";n.r(e);var o=n(237),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},254:function(t,e,n){"use strict";n.r(e);var o=n(238),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},259:function(t,e){},260:function(t,e){},261:function(t,e){},262:function(t,e){},263:function(t,e){},264:function(t,e){},265:function(t,e){},268:function(t,e,n){"use strict";n.r(e);var o=n(243),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},269:function(t,e,n){"use strict";var o=n(56),r={name:"VoteButton",props:{type:{required:!0,type:String,validator:t=>~["answer"].indexOf(t)},id:{required:!0,type:Number},score:{required:!0,type:Number},total:{required:!0,type:Number},authorId:{required:!0,type:Number},disabled:{type:Boolean,default:!1}},data(){return{loading:!1,totalVote:this.total,votedScore:this.score}},computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0}},methods:{async voteAction(t){if(!this.disabled)if(this.currentUserId)if(this.currentUserId!==this.authorId){if(!this.loading){this.loading=!0;try{const data=await Object(o.vote)({ctx:this,type:this.type,id:this.id,is_agree:t});this.totalVote=data.total,this.votedScore=data.result}finally{this.loading=!1}}}else this.$toast.error(t?"不能给自己点赞":"不能给自己点反对");else this.$channel.$emit("sign-in")}}},c=n(0);var component=Object(c.a)(r,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"vote-button"},[t._ssrNode("<button"+t._ssrClass("vote-btn vote-up",{active:t.votedScore>0})+'><i class="el-icon-caret-top"></i>'+t._ssrEscape("\n    赞同\n    "+t._s(t.totalVote)+"\n  ")+"</button> <button"+t._ssrClass("vote-btn vote-down",{active:t.votedScore<0})+'><i class="el-icon-caret-bottom"></i></button>')])},[],!1,function(t){var e=n(268);e.__inject__&&e.__inject__(t)},null,"57c08e92");e.a=component.exports},271:function(t,e,n){"use strict";n.d(e,"c",function(){return o}),n.d(e,"d",function(){return r}),n.d(e,"a",function(){return c}),n.d(e,"e",function(){return l}),n.d(e,"b",function(){return d});const o=(t,{id:e})=>t.$axios.$get(`question/soga/${e}/show`),r=(t,{id:e})=>t.$axios.$get(`question/soga/${e}/resource`),c=(t,{question_id:e,do_publish:n,geetest:o,source_url:r,content:content,intro:c})=>t.$axios.$post("question/soga/create",{question_id:e,do_publish:n,geetest:o,source_url:r,content:content,intro:c}),l=(t,{question_id:e,do_publish:n,geetest:o,source_url:r,content:content,intro:c,id:l})=>t.$axios.$post(`question/soga/${l}/update`,{question_id:e,do_publish:n,geetest:o,source_url:r,content:content,intro:c}),d=(t,{id:e})=>t.$axios.$post(`question/soga/${e}/delete`)},280:function(t,e){},281:function(t,e){},282:function(t,e){},289:function(t,e,n){"use strict";n.r(e);var o=n(259),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},290:function(t,e,n){"use strict";n.r(e);var o=n(260),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},291:function(t,e,n){"use strict";n.r(e);var o=n(261),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},292:function(t,e,n){"use strict";n.r(e);var o=n(262),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},293:function(t,e,n){"use strict";n.r(e);var o=n(263),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},294:function(t,e,n){"use strict";n.r(e);var o=n(264),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},295:function(t,e,n){"use strict";n.r(e);var o=n(265),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},299:function(t,e,n){"use strict";var o=n(204),r=n.n(o),c={name:"JsonItem",props:{item:{type:Object,required:!0},selected:{type:Boolean,required:!0,default:!1},index:{type:Number,required:!0}},computed:{sectionCount(){return this.$store.state.editor.sections.length}},methods:{emitPreview(){this.$emit("preview",{index:this.index})},emitCreate(t){this.$emit("create",{index:this.index,type:t})},emitDelete(){this.$emit("delete",{index:this.index})},emitSort(){this.$emit("sort",{index:this.index})},computeList(text){let t=text;for(;/\n\n/.test(t);)t=t.replace(/\n\n/g,"\n");return t.split("\n").slice(0,4)}}},l=n(0);var d=Object(l.a)(c,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"json-item",class:[{selected:t.selected},"json-item-"+t.index]},[t.selected&&t.sectionCount>1?n("el-button",{staticClass:"delete-btn",attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:""},on:{click:t.emitDelete}}):t._e(),t._ssrNode(" "),t.selected&&t.index?n("el-button",{staticClass:"up-btn",attrs:{icon:"el-icon-arrow-up",size:"mini",circle:""},on:{click:t.emitSort}}):t._e(),t._ssrNode(' <div class="show-area"><div class="capture">'+("img"===t.item.type?(t.item.url?'<div class="poster"'+t._ssrStyle(null,{backgroundImage:"url("+t.$resize(t.item.url,{width:150})+")"},null)+"></div>":"\x3c!----\x3e")+" "+(t.item.url?"\x3c!----\x3e":'<div class="default green"><i class="iconfont icon-image"></i></div>'):"txt"===t.item.type?'<div class="default yellow"><i class="iconfont icon-text"></i></div>':"list"===t.item.type?'<div class="default blue"><i class="iconfont icon-list"></i></div>':"use"===t.item.type?'<div class="default pink"><i class="iconfont icon-use"></i></div>':"title"===t.item.type?'<div class="default purple"><i class="iconfont icon-title"></i></div>':"\x3c!----\x3e")+'</div> <div class="content">'+("txt"===t.item.type?t.item.text?'<div class="text line-4">'+t._s(t.item.text)+"</div>":'<div class="text">\n          点击添加文字\n        </div>':"img"===t.item.type?t.item.text?'<div class="text line-4">'+t._s(t.item.text)+"</div>":t.item.url?'<div class="text">\n          点击编辑图片\n        </div>':'<div class="text">\n          点击上传图片\n        </div>':"list"===t.item.type?t.item.text?'<div class="text line-4">'+("1"===t.item.sort?"<ol>"+t._ssrList(t.computeList(t.item.text),function(li,e){return'<li><span class="oneline">'+t._ssrEscape(t._s(li))+"</span></li>"})+"</ol>":"<ul>"+t._ssrList(t.computeList(t.item.text),function(li,e){return'<li><span class="oneline">'+t._ssrEscape(t._s(li))+"</span></li>"})+"</ul>")+"</div>":'<div class="text">\n          点击添加列表\n        </div>':"use"===t.item.type?t.item.text?'<blockquote class="text line-4">'+t._s(t.item.text)+"</blockquote>":'<div class="text">\n          点击添加引用内容\n        </div>':"\x3c!----\x3e")+" "+("title"===t.item.type?t.item.text?'<div class="text line-4">'+t._s(t.item.text)+"</div>":'<div class="text">\n          点击添加标题\n        </div>':"\x3c!----\x3e")+"</div></div> "),t._ssrNode('<div class="append-area">',"</div>",[n("el-tooltip",{attrs:{content:"添加文本段落",placement:"top",effect:"dark"}},[n("el-button",{attrs:{type:"warning",icon:"iconfont icon-text",circle:"",plain:"",size:"mini"},on:{click:function(e){return t.emitCreate("txt")}}})],1),t._ssrNode(" "),n("el-tooltip",{attrs:{content:"添加图片段落",placement:"top",effect:"dark"}},[n("el-button",{attrs:{type:"success",icon:"iconfont icon-image",circle:"",plain:"",size:"mini"},on:{click:function(e){return t.emitCreate("img")}}})],1),t._ssrNode(" "),n("el-tooltip",{attrs:{content:"添加列表段落",placement:"top",effect:"dark"}},[n("el-button",{attrs:{type:"primary",icon:"iconfont icon-list",circle:"",plain:"",size:"mini"},on:{click:function(e){return t.emitCreate("list")}}})],1),t._ssrNode(" "),n("el-tooltip",{attrs:{content:"添加引用段落",placement:"top",effect:"dark"}},[n("el-button",{attrs:{type:"danger",icon:"iconfont icon-use",circle:"",plain:"",size:"mini"},on:{click:function(e){return t.emitCreate("use")}}})],1),t._ssrNode(" "),n("el-tooltip",{attrs:{content:"添加小标题",placement:"top",effect:"dark"}},[n("el-button",{attrs:{type:"info",icon:"iconfont icon-title",circle:"",plain:"",size:"mini"},on:{click:function(e){return t.emitCreate("title")}}})],1)],2)],2)},[],!1,function(t){var e=n(289);e.__inject__&&e.__inject__(t)},null,"72cc0eb2").exports,m={name:"ImgPreview",mixins:[n(6).a],props:{item:{required:!0,type:Object}},data:()=>({saving:!1}),computed:{desc:{get(){return this.item.text},set(t){this.$store.commit("editor/UPDATE_SECTION_TEXT",{value:t})}}},mounted(){this.getUpToken(),this.$channel.$on("write-save-done",()=>{this.saving=!1})},methods:{handleImageUploadSuccess(t){this.$store.commit("editor/UPDATE_SECTION_IMAGE",{url:t.data.url,width:t.data.width,height:t.data.height,size:t.data.size,mime:t.data.type}),this.$toast.success("上传成功")},beforeUpload(t){return this.uploadConfig.max=5,this.uploadConfig.pathPrefix=`user/${this.$store.state.user.id}/create`,this.beforeImageUpload(t)},emitSave(){this.item.url&&(this.$channel.$emit("write-save"),this.saving=!0)}}};var h=Object(l.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"image-preview"},[t._ssrNode('<div class="body">',"</div>",[t.item.url?t._ssrNode('<div class="wrapper">',"</div>",[n("v-img",{attrs:{src:t.item.url,width:t.item.width,height:t.item.height,blur:!0,full:!0,lazy:!1}}),t._ssrNode(" "),n("el-input",{staticClass:"focus-textarea mousetrap",attrs:{maxlength:"45",placeholder:"添加图片描述"},model:{value:t.desc,callback:function(e){t.desc="string"==typeof e?e.trim():e},expression:"desc"}})],2):n("el-upload",{staticClass:"uploader",attrs:{data:t.uploadHeaders,action:t.imageUploadAction,accept:t.imageUploadAccept,"before-upload":t.beforeUpload,"on-success":t.handleImageUploadSuccess,drag:""}},[n("i",{staticClass:"el-icon-upload"}),t._v(" "),n("div",{staticClass:"el-upload__text"},[t._v("\n        将图片拖到此处，或"),n("em",[t._v("点击上传")])])])],1),t._ssrNode(" "),t._ssrNode('<div class="footer">',"</div>",[n("el-upload",{staticStyle:{display:"inline-block","margin-right":"10px"},attrs:{data:t.uploadHeaders,action:t.imageUploadAction,accept:t.imageUploadAccept,"show-file-list":!1,"before-upload":t.beforeUpload,"on-success":t.handleImageUploadSuccess}},[t.item.url?n("el-button",{attrs:{size:"small",plain:"",round:""}},[t._v("\n        更换图片\n      ")]):t._e()],1),t._ssrNode(" "),t.item.url?n("el-button",{staticClass:"save-btn",attrs:{size:"small",type:"primary",round:""},on:{click:t.emitSave}},[t._v("\n      保存\n    ")]):t._e()],2)],2)},[],!1,function(t){var e=n(290);e.__inject__&&e.__inject__(t)},null,"6395b238").exports,_={name:"TxtPreview",props:{item:{required:!0,type:Object}},data:()=>({saving:!1}),computed:{text:{get(){return this.item.text.replace(/<br>/g,"\n")},set(t){this.$store.commit("editor/UPDATE_SECTION_TEXT",{value:t.replace(/\n/g,"<br>")})}}},mounted(){this.$channel.$on("write-save-done",()=>{this.saving=!1})},methods:{emitSave(){this.text.replace(/\n/g,"")&&(this.$channel.$emit("write-save"),this.saving=!0)}}};var f=Object(l.a)(_,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"text-preview"},[this._ssrNode('<div class="text-area"><textarea placeholder="添加文字内容" class="focus-textarea mousetrap"></textarea></div>')])},[],!1,function(t){var e=n(291);e.__inject__&&e.__inject__(t)},null,"8877ed2a").exports,v={name:"ListPreview",props:{item:{required:!0,type:Object}},data:()=>({saving:!1}),computed:{text:{get(){return this.item.text.replace(/<br>/g,"\n")},set(t){this.$store.commit("editor/UPDATE_SECTION_TEXT",{value:t})}},sort:{get(){return"1"===this.item.sort},set(t){this.$store.commit("editor/UPDATE_SECTION_SORT",{value:t?"1":"0"})}}},mounted(){this.$channel.$on("write-save-done",()=>{this.saving=!1})},methods:{textAreaFocus(){this.text.length<100&&(document.body.scrollTop=0)},emitSave(){this.text.replace(/\n/g,"")&&(this.$channel.$emit("write-save"),this.saving=!0)}}};var y=Object(l.a)(v,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"list-preview"},[t._ssrNode('<div class="sort-wrap">',"</div>",[t._ssrNode("<span>"+t._ssrEscape("顺序："+t._s(t.sort?"有序":"无序"))+"</span> "),n("el-switch",{model:{value:t.sort,callback:function(e){t.sort=e},expression:"sort"}})],2),t._ssrNode(' <div class="content-wrap"><pre class="shim">'+t._s(t.item.text)+'</pre> <textarea placeholder="添加文字列表，回车分割" class="focus-textarea mousetrap"></textarea></div>')],2)},[],!1,function(t){var e=n(292);e.__inject__&&e.__inject__(t)},null,"bf4052b2").exports,w={name:"UsePreview",props:{item:{required:!0,type:Object}},data:()=>({saving:!1}),computed:{text:{get(){return this.item.text.replace(/<br>/g,"\n")},set(t){this.$store.commit("editor/UPDATE_SECTION_TEXT",{value:t.replace(/\n/g,"<br>")})}},title:{get(){return this.item.title},set(t){this.$store.commit("editor/UPDATE_SECTION_TITLE",{value:t})}}},mounted(){this.$channel.$on("write-save-done",()=>{this.saving=!1})},methods:{textAreaFocus(){this.text.length<100&&(document.body.scrollTop=0)},emitSave(){this.text.replace(/\n/g,"")&&(this.$channel.$emit("write-save"),this.saving=!0)}}};var x=Object(l.a)(w,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"text-preview"},[this._ssrNode('<div class="text-area use-area"><textarea placeholder="添加文字内容" class="focus-textarea mousetrap"></textarea></div>')])},[],!1,function(t){var e=n(293);e.__inject__&&e.__inject__(t)},null,"fcabfc18").exports,$={name:"TxtPreview",props:{item:{required:!0,type:Object}},data:()=>({saving:!1}),computed:{text:{get(){return this.item.text},set(t){this.$store.commit("editor/UPDATE_SECTION_TEXT",{value:t})}}},mounted(){this.$channel.$on("write-save-done",()=>{this.saving=!1})},methods:{emitSave(){this.text.replace(/\n/g,"")&&(this.$channel.$emit("write-save"),this.saving=!0)}}};var C={name:"JsonEditorMain",components:{JsonItem:d,ImgPreview:h,TxtPreview:f,UsePreview:x,ListPreview:y,TitlePreview:Object(l.a)($,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"title-preview"},[this._ssrNode('<input type="text" placeholder="段落小标题" maxlength="30"'+this._ssrAttr("value",this.text)+' class="title-input focus-textarea mousetrap">')])},[],!1,function(t){var e=n(294);e.__inject__&&e.__inject__(t)},null,"4f86adc3").exports},props:{},computed:{id(){return+(this.$route.query.id||0)},sections(){return this.$store.state.editor.sections},selectedIndex(){return this.$store.state.editor.selectedIndex},curPreview(){return this.sections[this.selectedIndex]}},mounted(){this.$channel.$on("write-save",(t=!1)=>{const e=this.getRichContent();e.length?this.$emit("submit",{content:e,desc:this.getPureContent(),publish:!1,id:this.id,auto:t}):this.$toast.info("内容不能为空！")}),this.$channel.$on("write-publish",()=>{const t=this.getRichContent();t.length?this.$emit("submit",{content:t,desc:this.getPureContent(),publish:!0,id:this.id}):this.$toast.info("内容不能为空！")}),r.a.bind(["command+s","ctrl+s"],()=>(this.id&&this.$channel.$emit("write-save",!0),!1))},methods:{getRichContent(){const t=[];return this.sections.forEach(e=>{"img"===e.type?e.url&&t.push(e):"txt"===e.type?e.text&&t.push(e):"use"===e.type?e.text&&t.push(e):"list"===e.type?e.text&&t.push(e):"title"===e.type&&e.text&&t.push(e)}),t},getPureContent(){let t="";return this.sections.forEach(e=>{if("txt"===e.type&&e.text&&(t+=`${e.text.replace(/<br>/g,"\n")} `),"title"===e.type&&e.text&&(t+=`${e.text} `),"use"===e.type&&e.text&&(t+=`${e.text.replace(/<br>/g,"\n")} `),"list"===e.type&&e.text){(t=>{if(!t)return[];for(;/\n\n/.test(t);)t=t.replace(/\n\n/g,"\n");return t.split("\n")})(e.text).forEach((p,e)=>{t+=`${e+1}:${p} `})}}),t.slice(0,-1)},handleItemPreview({index:t}){this.$store.commit("editor/SWITCH_SECTION",{index:t}),this.focusTextareaAndScroll()},handleItemAppend({index:t,type:e}){this.$store.commit("editor/APPEND_SECTION",{index:t,type:e}),this.focusTextareaAndScroll(t)},handleItemDelete({index:t}){this.$store.commit("editor/DELETE_SECTION",{index:t})},handleItemSort({index:t}){this.$store.commit("editor/SORT_SECTION",{index:t})},focusTextareaAndScroll(t){this.$nextTick(()=>{const textarea=this.$el.querySelector(".focus-textarea");if(textarea&&textarea.focus(),t===this.sections.length-2){document.querySelector(`.json-item-${t}`)&&this.$scrollToY(300*(t+2),1e3,document.querySelector(".editor-tabs"))}})}}};var N=Object(l.a)(C,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"json-editor-main"},[t._ssrNode('<div class="editor-tabs">',"</div>",[n("transition-group",{staticClass:"list-complete-wrap",attrs:{name:"list-complete",tag:"div"}},t._l(t.sections,function(e,o){return n("json-item",{key:e.id,staticClass:"list-complete-item",attrs:{item:e,index:o,selected:o===t.selectedIndex},on:{preview:t.handleItemPreview,create:t.handleItemAppend,delete:t.handleItemDelete,sort:t.handleItemSort}})}),1)],1),t._ssrNode(" "),n(t.curPreview.type+"-preview",{tag:"component",staticClass:"editor-preview",attrs:{item:t.curPreview}})],2)},[],!1,function(t){var e=n(295);e.__inject__&&e.__inject__(t)},null,"dd1f98d4");e.a=N.exports},369:function(t,e,n){"use strict";n.r(e);var o=n(280),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},370:function(t,e,n){"use strict";n.r(e);var o=n(281),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},371:function(t,e,n){"use strict";n.r(e);var o=n(282),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},381:function(t,e){},394:function(t,e,n){"use strict";var o=n(299),r=n(271),c={name:"CreateAnswerForm",components:{JsonEditor:o.a},props:{title:{required:!0,type:String},questionId:{required:!0,type:Number},value:{required:!0,type:Boolean},answerId:{type:Number,default:0},published:{required:!0,type:Boolean}},data(){return{id:this.answerId,show:this.value,source_url:"",saving:!1}},computed:{resource(){return this.$store.state.editor.resource}},mounted(){this.$watch("show",t=>{this.$emit("input",t)}),this.$watch("value",t=>{this.show=t,this.loadEditContent()})},methods:{beforeSubmit(t){!this.source_url||/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i.test(this.source_url)?this.saving||(this.saving=!0,this.id?this.submit(t):this.$captcha({ctx:this,success:({data:data})=>{this.submit(t,data)},close:()=>{this.saving=!1}})):this.$toast.error("请输入合法转载链接")},async submit(t,e={}){this.$channel.$emit("write-submit",!0);try{let n=null;const form={question_id:this.questionId,content:t.content,intro:t.desc.substring(0,120),do_publish:t.publish,source_url:this.source_url.split("?")[0],geetest:e};this.id?(form.id=this.id,await Object(r.e)(this,form)):(n=await Object(r.a)(this,form),this.id=n.data),t.publish?this.$toast.success(n?n.message:"发布成功").then(()=>{window.location.href=this.$alias.answer(this.id)}):(this.$toast.success("编辑成功！"),this.$store.commit("question/EDIT_ANSWER",{id:this.id}),this.closeEditor())}catch(t){}finally{this.saving=!1}},loadEditContent(){this.resource&&(this.source_url=this.resource.source_url)},closeEditor(){this.show=!1}}},l=n(0);var d=Object(l.a)(c,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-dialog",{attrs:{footer:!1,header:!1,fullscreen:!0,close:!1,width:"100%"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[n("div",{staticClass:"container",attrs:{id:"create-answer-form"}},[n("h1",{staticClass:"qaq-title",domProps:{textContent:t._s(t.title)}}),t._v(" "),n("json-editor",{on:{submit:t.beforeSubmit}})],1),t._v(" "),n("div",{staticClass:"qaq-editor-footer"},[n("div",{staticClass:"container"},[n("el-input",{staticClass:"source-url",attrs:{placeholder:"如果是转载，请复制原文链接至此",size:"medium"},model:{value:t.source_url,callback:function(e){t.source_url=e},expression:"source_url"}}),t._v(" "),n("el-button",{attrs:{type:"text",size:"medium"},on:{click:t.closeEditor}},[t._v("\n        取消\n      ")]),t._v(" "),t.published?t._e():n("el-button",{attrs:{loading:t.saving,plain:"",size:"medium"},on:{click:function(e){return t.$channel.$emit("write-save")}}},[t._v("\n        "+t._s(t.id?"更新草稿":"存草稿")+"\n      ")]),t._v(" "),n("el-button",{attrs:{loading:t.saving,size:"medium",type:"primary"},on:{click:function(e){return t.$channel.$emit("write-publish")}}},[t._v("\n        "+t._s(t.published?"更新回答":t.id?"发布回答":"提交回答")+"\n      ")])],1)])])},[],!1,function(t){var e=n(369);e.__inject__&&e.__inject__(t)},null,"61c7c30e").exports,m={name:"QuestionPanel",components:{CommentMain:n(247).a,CreateAnswerForm:d},props:{qaq:{required:!0,type:Object},answer:{type:Object,default:null}},data:()=>({collapsed:!0,loadingFollowers:!1,showCommentModal:!1,showCreateAnswerForm:!1}),computed:{id(){return this.qaq.id},followState(){return this.$store.getters["social/getState"]("question",this.id)},collapsedContent(){let text=this.qaq.intro.substring(0,78);return this.qaq.images.length&&(text+="[图片]"),`${text}...`},answerPage(){return!!this.answer},isGuest(){return!this.$store.state.login},isMyAnswer(){return!(this.isGuest||!this.answerPage)&&this.answer.user.id===this.$store.state.user.id},isMyQAQ(){return!this.isGuest&&!this.answerPage&&this.qaq.user.id===this.$store.state.user.id}},created(){this.collapsed=this.qaq.intro||this.qaq.images.length},mounted(){this.$channel.$on("open-write-answer-dialog",(t=!1)=>{if(!this.$store.state.login)return this.$toast.info("继续操作前请先登录"),void this.$channel.$emit("sign-in");t?this.editMyAnswer():this.showCreateAnswerForm=!0})},methods:{async editMyAnswer(){try{const data=await Object(r.d)(this,{id:this.qaq.my_answer.id});this.$store.commit("editor/INIT_SECTION",data),this.showCreateAnswerForm=!0}catch(t){}},loadQAQComment(){this.showCommentModal=!0,this.$nextTick(()=>{this.$channel.$emit(`fire-load-comment-question-${this.id}`)})},collapsedQAQ(){this.collapsed=!0,window.scrollTo(0,0)},handleCommentChange(t){this.qaq.comment_count+=t},beginWriteAnswer(){if(!this.$store.state.login)return this.$toast.info("继续操作前请先登录"),void this.$channel.$emit("sign-in");this.showCreateAnswerForm=!0},toggleQuestionFollow(){this.$store.dispatch("social/toggleAction",{id:this.id,type:"question",action:"follow"})}}};var h=Object(l.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.qaq?n("div",{attrs:{id:"question-panel"}},[n("v-layout",[n("div",{staticClass:"qaq-question"},[n("ul",{staticClass:"qaq-tags"},t._l(t.qaq.tags,function(e){return n("li",{key:e.id,staticClass:"tag"},[n("a",{staticClass:"tag-btn",attrs:{href:t.$alias.bangumi(e.id),target:"_blank"},domProps:{textContent:t._s(e.name)}})])}),0),t._v(" "),n("div",{staticClass:"title"},[n("h1",{domProps:{textContent:t._s(t.qaq.title)}})]),t._v(" "),n("div",{staticClass:"content"},[t.collapsed?n("div",{staticClass:"collapsed-content"},[t._v("\n          "+t._s(t.collapsedContent)+"\n          "),n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){t.collapsed=!1}}},[t._v("\n            显示全部\n            "),n("i",{staticClass:"el-icon-arrow-down"})])],1):[n("div",{staticClass:"text-area",domProps:{innerHTML:t._s(t.qaq.content)}}),t._v(" "),t._l(t.qaq.images,function(img,t){return n("div",{key:t,staticClass:"image-package"},[n("v-img",{staticClass:"image",attrs:{src:img.url,width:img.width,height:img.height,blur:!0,full:!0}})],1)})]],2),t._v(" "),n("div",{staticClass:"panel"},[n("el-button",{attrs:{loading:t.followState.follow_loading,type:t.followState.follow?"info":"default",icon:"iconfont icon-follow",size:"medium"},on:{click:t.toggleQuestionFollow}},[t._v("\n          "+t._s(t.followState.follow?"取消关注":"关注问题")+"\n        ")]),t._v(" "),t.qaq.my_answer?[t.answerPage?[t.isMyAnswer?n("el-button",{attrs:{plain:"",size:"medium",type:"primary"},on:{click:t.editMyAnswer}},[n("i",{staticClass:"el-icon-edit"}),t._v("\n              编辑回答\n            ")]):t.qaq.my_answer.published_at?n("a",{attrs:{href:t.$alias.answer(t.qaq.my_answer.id),target:"_blank"}},[n("el-button",{attrs:{plain:"",size:"medium"}},[n("i",{staticClass:"el-icon-view"}),t._v("\n                查看回答\n              ")])],1):t._e()]:[t.qaq.my_answer.published_at?n("a",{attrs:{href:t.$alias.answer(t.qaq.my_answer.id),target:"_blank"}},[n("el-button",{attrs:{plain:"",size:"medium"}},[n("i",{staticClass:"el-icon-view"}),t._v("\n                查看回答\n              ")])],1):n("el-button",{attrs:{plain:"",size:"medium",type:"primary"},on:{click:t.editMyAnswer}},[n("i",{staticClass:"el-icon-edit"}),t._v("\n              编辑回答\n            ")])]]:n("el-button",{attrs:{plain:"",size:"medium"},on:{click:t.beginWriteAnswer}},[n("i",{staticClass:"el-icon-edit"}),t._v("\n          写回答\n        ")]),t._v(" "),n("el-button",{attrs:{type:"text",size:"medium"},on:{click:t.loadQAQComment}},[n("i",{staticClass:"iconfont icon-pinglun1"}),t._v("\n          "+t._s(t.qaq.comment_count?t.qaq.comment_count+" 条评论":"添加评论")+"\n        ")]),t._v(" "),n("v-share",{attrs:{url:t.$alias.question(t.id),title:t.qaq.title,desc:t.qaq.intro,type:"button"}}),t._v(" "),n("report-dialog",{attrs:{id:t.id,type:"question"}},[n("el-button",{attrs:{type:"text",size:"medium",icon:"el-icon-phone"}},[t._v("\n            举报\n          ")])],1),t._v(" "),t.collapsed?t._e():n("el-button",{staticClass:"fr",attrs:{type:"text",size:"medium"},on:{click:t.collapsedQAQ}},[n("i",{staticClass:"el-icon-arrow-up"}),t._v("\n          收起\n        ")])],2),t._v(" "),n("v-dialog",{staticClass:"comment-dialog",attrs:{header:!1,footer:!1,close:!1,height:"600px"},model:{value:t.showCommentModal,callback:function(e){t.showCommentModal=e},expression:"showCommentModal"}},[n("comment-main",{attrs:{id:t.id,"master-id":t.qaq.user_id,auto:!0,"empty-text":"还没有评论",type:"question"},on:{"delete-main-comment":function(e){return t.handleCommentChange(-1)},"create-main-comment":function(e){return t.handleCommentChange(1)}}})],1)],1),t._v(" "),n("div",{staticClass:"question-aside",attrs:{slot:"aside"},slot:"aside"},[n("div",{staticClass:"meta-item"},[n("div",{staticClass:"meta-text"},[t._v("\n          被浏览 "+t._s(t.qaq.view_count)+"\n        ")])]),t._v(" "),n("div",{staticClass:"meta-item"},[n("div",{staticClass:"meta-text"},[t._v("\n          关注者 "+t._s(t.followState.follow_users.total)+"\n        ")]),t._v(" "),t.followState.follow_users.total?n("ava-dialog",{attrs:{id:t.id,title:"《"+t.followState.follow_users.total+"》人关注了",type:"question",action:"follow"}}):t._e()],1)])]),t._ssrNode(" "),n("create-answer-form",{attrs:{title:t.qaq.title,"question-id":t.id,"answer-id":t.qaq.my_answer?t.qaq.my_answer.id:0,published:!!t.qaq.my_answer&&!!t.qaq.published_at},model:{value:t.showCreateAnswerForm,callback:function(e){t.showCreateAnswerForm=e},expression:"showCreateAnswerForm"}})],2):t._e()},[],!1,function(t){var e=n(370);e.__inject__&&e.__inject__(t)},null,"4924b513");e.a=h.exports},397:function(t,e,n){"use strict";var o=n(62),r=n(269),c=n(247),l=n(271),d={name:"AnswerFlowItem",components:{JsonContent:o.a,VoteButton:r.a,CommentMain:c.a},props:{item:{required:!0,type:Object},qaq:{required:!0,type:Object}},data:()=>({showCommentModal:!1}),computed:{isMine(){return!!this.$store.state.login&&this.$store.state.user.id===this.item.user.id}},methods:{loadAnswerComment(){this.showCommentModal=!0,this.$nextTick(()=>{this.$channel.$emit(`fire-load-comment-answer-${this.item.id}`)})},deleteAnswer(){this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Object(l.b)(this,{id:this.item.id}),this.$toast.success("删除成功").then(()=>{window.location.reload()})}catch(t){}}).catch(()=>{})},handleCommentChange(t){this.item.comment_count+=t}}},m=n(0);var component=Object(m.a)(d,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"answer-flow-item",attrs:{id:"answer-"+t.item.id}},[t._ssrNode('<header class="answer-header">',"</header>",[n("user-card",{attrs:{id:t.item.user.id,zone:t.item.user.zone,"custom-class":"user-avatar"}},[n("v-img",{attrs:{src:t.item.user.avatar,width:40,height:40}})],1),t._ssrNode(' <div class="info"><a'+t._ssrAttr("href",t.$alias.user(t.item.user.zone))+' target="_blank" class="nickname">'+t._ssrEscape(t._s(t.item.user.nickname))+'</a> <p class="oneline signature">'+t._ssrEscape(t._s(t.item.user.signature))+"</p></div>")],2),t._ssrNode(" "),t.item.vote_count?t._ssrNode('<div class="answer-meta">',"</div>",[t._ssrNode((t.item.source_url?"<span><a"+t._ssrAttr("href",t.item.source_url)+' target="_blank">\n        原文链接\n      </a>\n       · \n    </span>':"\x3c!----\x3e")+" "),t.item.created_at===t.item.published_at?t._ssrNode("<span>","</span>",[t._ssrNode("\n      发布于\n      "),n("v-time",{model:{value:t.item.created_at,callback:function(e){t.$set(t.item,"created_at",e)},expression:"item.created_at"}})],2):t._ssrNode("<span>","</span>",[t._ssrNode("\n      编辑于\n      "),n("el-tooltip",{attrs:{content:"发布于："+t.item.created_at,placement:"top",effect:"dark"}},[n("v-time",{model:{value:t.item.published_at,callback:function(e){t.$set(t.item,"published_at",e)},expression:"item.published_at"}})],1)],2),t._ssrNode("\n     · \n    <span>"+t._ssrEscape(" "+t._s(t.item.vote_count)+" 赞同了该回答 ")+"</span>")],2):t._e(),t._ssrNode(" "),t._ssrNode('<main class="answer-content">',"</main>",[n("json-content",{attrs:{content:t.item.content}})],1),t._ssrNode(" "),t._ssrNode('<footer class="answer-footer">',"</footer>",[n("vote-button",{attrs:{id:t.item.id,total:t.item.vote_count,score:t.item.voted,"author-id":t.item.user.id,type:"answer"}}),t._ssrNode(" "),n("el-button",{attrs:{type:"text",size:"medium"},on:{click:t.loadAnswerComment}},[n("i",{staticClass:"iconfont icon-pinglun1"}),t._v("\n      "+t._s(t.item.comment_count?t.item.comment_count+" 条评论":"添加评论")+"\n    ")]),t._ssrNode(" "),n("v-share",{attrs:{url:t.$alias.answer(t.item.id),title:t.qaq.title,desc:t.item.intro,type:"button"}}),t._ssrNode(" "),t.isMine?[n("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(e){return t.$channel.$emit("open-write-answer-dialog",!0)}}},[n("i",{staticClass:"el-icon-edit"}),t._v("\n        编辑\n      ")]),t._ssrNode(" "),n("el-button",{attrs:{type:"text",size:"medium"},on:{click:t.deleteAnswer}},[n("i",{staticClass:"el-icon-delete"}),t._v("\n        删除\n      ")])]:t._e(),t._ssrNode(" "),n("report-dialog",{attrs:{id:t.item.id,type:"answer"}},[n("el-button",{attrs:{type:"text",size:"medium",icon:"el-icon-phone"}},[t._v("\n        举报\n      ")])],1)],2),t._ssrNode(" "),n("v-dialog",{staticClass:"comment-dialog",attrs:{header:!1,footer:!1,close:!1,height:"600px"},model:{value:t.showCommentModal,callback:function(e){t.showCommentModal=e},expression:"showCommentModal"}},[n("comment-main",{attrs:{id:t.item.id,"master-id":t.item.user.id,auto:!0,"empty-text":"还没有评论",type:"answer"},on:{"delete-main-comment":function(e){return t.handleCommentChange(-1)},"create-main-comment":function(e){return t.handleCommentChange(1)}}})],1)],2)},[],!1,function(t){var e=n(371);e.__inject__&&e.__inject__(t)},null,"23e77d50");e.a=component.exports},474:function(t,e,n){"use strict";n.r(e);var o=n(381),r=n.n(o);for(var c in o)"default"!==c&&function(t){n.d(e,t,function(){return o[t]})}(c);e.default=r.a},515:function(t,e,n){"use strict";n.r(e);var o=n(394),r=n(397),c=n(271),l={name:"AnswerShow",validate:({params:t})=>/^\d+$/.test(t.id),components:{QuestionPanel:o.a,AnswerFlowItem:r.a},props:{id:{type:String,required:!0}},data:()=>({qaq:null,answer:null}),asyncData({app:t,store:e,params:n,error:o}){const{id:r}=n;return Object(c.c)(t,{id:r}).then(data=>{const{question:t}=data;return e.commit("social/SET_STATE",{type:"question",id:t.id,data:{follow:t.followed,follow_users:t.follow_users}}),{answer:data.answer,qaq:t}}).catch(t=>{o({statusCode:t.statusCode,message:t.message})})},head(){return{title:this.qaq.title}}},d=n(0);var component=Object(d.a)(l,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"answer-show"}},[n("v-header",{attrs:{type:"pure","margin-bottom":"0"}}),t._ssrNode(" "),n("question-panel",{attrs:{qaq:t.qaq,answer:t.answer}}),t._ssrNode(" "),n("v-layout",[t.answer?n("div",{staticClass:"answer"},[n("a",{attrs:{href:t.$alias.question(t.qaq.id)}},[t.qaq.answer_count>1?n("el-button",{staticClass:"read-all-btn"},[t._v("查看全部 "+t._s(t.qaq.answer_count)+" 个回答")]):n("el-button",{staticClass:"read-all-btn"},[t._v("查看问题")])],1),t._v(" "),n("answer-flow-item",{attrs:{item:t.answer,qaq:t.qaq}}),t._v(" "),n("a",{attrs:{href:t.$alias.question(t.qaq.id)}},[t.qaq.answer_count>1?n("el-button",{staticClass:"read-all-btn"},[t._v("查看全部 "+t._s(t.qaq.answer_count)+" 个回答")]):n("el-button",{staticClass:"read-all-btn"},[t._v("查看问题")])],1)],1):n("no-content",[t.qaq.answer_count?n("a",{attrs:{href:t.$alias.question(t.qaq.id)}},[n("el-button",{attrs:{type:"primary",round:""}},[t._v("这个答案在审核中或已被删除，查看其它答案")])],1):t._e()]),t._v(" "),n("template",{slot:"aside"},[t._v("\n       \n    ")])],2)],2)},[],!1,function(t){var e=n(474);e.__inject__&&e.__inject__(t)},null,"1f9f60d7");e.default=component.exports}};
//# sourceMappingURL=_id.chunk.c1741e8d.js.map
exports.ids=[18],exports.modules={277:function(e,t){},302:function(e,t,o){"use strict";o.d(t,"c",function(){return r}),o.d(t,"d",function(){return n}),o.d(t,"a",function(){return d}),o.d(t,"b",function(){return l}),o.d(t,"e",function(){return c});const r=(e,{id:t})=>e.$axios.$get(`video/${t}/show?refer=web`),n=(e,{id:t})=>e.$axios.$post("video/playing",{id:t}),d=(e,{season_id:t})=>e.$axios.$post("video/buy",{season_id:t}),l=(e,form)=>e.$axios.$post("video/create",form),c=(e,t,form)=>e.$axios.$post(`video/${t}/update`,form)},359:function(e,t){},360:function(e,t,o){"use strict";o.r(t);var r=o(277),n=o.n(r);for(var d in r)"default"!==d&&function(e){o.d(t,e,function(){return r[e]})}(d);t.default=n.a},396:function(e,t,o){"use strict";var r=o(6),n=o(302),d={name:"EditVideoForm",mixins:[r.a],props:{season:{type:Array,default:()=>[]},videoId:{type:[Number,String],default:0},seasonId:{type:[Number,String],default:""},bangumiId:{required:!0,type:[Number,String]},video:{type:Object,default:null}},data(){return{submitting:!1,form:{season_id:this.seasonId?this.seasonId:this.season[this.season.length-1].id,bangumi_id:this.bangumiId,name:this.video?this.video.name:"",episode:this.video?this.video.episode:0,poster:this.video?this.video.poster.split("calibur.tv/")[1]:"",baidu_cloud_src:this.video&&this.video.is_baidu_cloud?this.video.src:"",baidu_cloud_pwd:this.video?this.video.baidu_cloud_pwd:""},rule:{name:[{validator:(e,t,o)=>t?t.length>30?o(new Error("名字最长 30 个字")):void o():o(new Error("请先填名字")),trigger:"submit"}],episode:[{validator:(e,t,o)=>{if(!t)return o(new Error("集数是必填的"));o()},trigger:"submit"}],poster:[{validator:(e,t,o)=>{if(!t)return o(new Error("请选择一个封面"));o()},trigger:"submit"}],baidu_cloud_src:[{validator:(e,t,o)=>""===t?o():/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i.test(t)?/pan.baidu.com/.test(t)?void o():o(new Error("只支持百度云资源")):o(new Error("请输入合法链接")),trigger:"submit"}],baidu_cloud_pwd:[{validator:(e,t,o)=>{if(t.length>6)return o(new Error("密码长度在6位以内"));o()},trigger:"submit"}]}}},computed:{minPart(){let e=1;return this.season.forEach(t=>{t.id===this.form.season_id&&(e=t.last_part)}),e},currentUserId(){return this.$store.state.user.id}},methods:{submit(){this.$refs.form.validate(e=>{if(!e)return!1;this.submitting||(this.submitting=!0,this.videoId?Object(n.e)(this,this.videoId,Object.assign({},this.form,{baidu_cloud_src:this.form.baidu_cloud_src.split("?")[0]})).then(()=>{window.location.reload()}).catch(e=>{this.$toast.error(e),this.submitting=!1}):Object(n.b)(this,Object.assign({},this.form,{baidu_cloud_src:this.form.baidu_cloud_src.split("?")[0]})).then(e=>{this.$refs.form.resetFields(),this.$refs.upload.clearFiles(),this.submitting=!1,this.$confirm("是否前往视频页面?","提示",{confirmButtonText:"前往查看",cancelButtonText:"留在这里",type:"warning"}).then(()=>{window.location=this.$alias.video(e)}).catch(()=>{})}).catch(e=>{this.$toast.error(e),this.submitting=!1}))})},beforePosterUpload(e){return this.uploadConfig.max=1,this.uploadConfig.pathPrefix=`user/${this.currentUserId}/album`,this.beforeImageUpload(e)},handleAlbumUploadSuccess(e){this.form.poster=e.data.url,this.$toast.success("封面上传成功")},handlePosterRemove(){this.form.poster=null}}},l=o(0);var component=Object(l.a)(d,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"edit-video-form"},[o("el-form",{ref:"form",attrs:{model:e.form,rules:e.rule,disabled:e.submitting,"label-width":"45px"}},[o("el-form-item",{attrs:{label:"名字",prop:"name"}},[o("el-input",{staticStyle:{width:"450px"},attrs:{placeholder:"填写这一话的名字"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"集数",prop:"episode"}},[o("el-input-number",{attrs:{min:e.minPart,step:.5},model:{value:e.form.episode,callback:function(t){e.$set(e.form,"episode",t)},expression:"form.episode"}})],1),e._v(" "),!e.videoId&&e.season.length>1?o("el-form-item",{attrs:{label:"季度",prop:"season_id"}},[o("el-select",{attrs:{placeholder:"请选择季度"},model:{value:e.form.season_id,callback:function(t){e.$set(e.form,"season_id",t)},expression:"form.season_id"}},e._l(e.season,function(e){return o("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})}),1)],1):e._e(),e._v(" "),o("el-form-item",{attrs:{label:"封面",prop:"poster"}},[o("el-upload",{ref:"upload",attrs:{data:e.uploadHeaders,"on-error":e.handleImageUploadError,"on-success":e.handleAlbumUploadSuccess,"before-upload":e.beforePosterUpload,"on-remove":e.handlePosterRemove,action:e.imageUploadAction,accept:e.imageUploadAccept}},[o("el-button",{attrs:{loading:e.submitting,size:"small",round:""}},[e._v("上传封面图")])],1),e._v(" "),e.form.poster?o("div",{staticClass:"preview-poster",style:{backgroundImage:"url("+e.$resize(e.form.poster,{width:400,mode:2})+")"}}):e._e()],1),e._v(" "),o("el-form-item",{attrs:{label:"链接",prop:"baidu_cloud_src"}},[o("el-input",{attrs:{placeholder:"填写百度云视频链接"},model:{value:e.form.baidu_cloud_src,callback:function(t){e.$set(e.form,"baidu_cloud_src",t)},expression:"form.baidu_cloud_src"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"密码",prop:"baidu_cloud_pwd"}},[o("el-input",{attrs:{placeholder:"填写百度云视频密码，最长6位，可空"},model:{value:e.form.baidu_cloud_pwd,callback:function(t){e.$set(e.form,"baidu_cloud_pwd",t)},expression:"form.baidu_cloud_pwd"}})],1),e._v(" "),o("el-form-item",[o("el-button",{attrs:{loading:e.submitting,type:"primary",size:"small"},on:{click:e.submit}},[e._v("确认提交")])],1)],1)],1)},[],!1,function(e){var t=o(360);t.__inject__&&t.__inject__(e)},null,"2c87dd71");t.a=component.exports},455:function(e,t,o){"use strict";o.r(t);var r=o(359),n=o.n(r);for(var d in r)"default"!==d&&function(e){o.d(t,e,function(){return r[e]})}(d);t.default=n.a},507:function(e,t,o){"use strict";o.r(t);var r=o(61),n={name:"VideoFlowItem",props:{item:{type:Object,required:!0},bangumiId:{type:[String,Number],default:""},userZone:{type:String,default:""}}},d=o(0);var l=Object(d.a)(n,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("li",{key:e.item.id,staticClass:"video-flow-item"},[e._ssrNode("<a"+e._ssrAttr("href",e.$alias.video(e.item.id))+' target="_blank">',"</a>",[o("v-img",{staticClass:"poster",attrs:{src:e.item.poster,blur:!0,width:"106",height:"60"}}),e._ssrNode(' <div class="intro"><p class="part oneline">'+e._ssrEscape("第"+e._s(e.item.part)+"话")+'</p> <span class="name">'+e._ssrEscape(e._s(e.item.name))+"</span></div>")],2)])},[],!1,function(e){var t=o(455);t.__inject__&&t.__inject__(e)},null,"10db5073").exports,c={name:"BangumiVideo",components:{EditVideoForm:o(396).a,VideoFlowItem:l},props:{id:{required:!0,type:String}},data:()=>({source:null,showDialog:!1}),computed:{computedSeason(){const e=this.source.season.map(e=>e);return this.source.videos.forEach((t,o)=>{const r=t.data[t.data.length-1];e[o].last_part=r?+r.episode+1:0}),e},bangumi(){return this.$store.state.bangumi.show}},asyncData:({params:e,app:t,error:o})=>Object(r.h)(t,{id:e.id}).then(source=>({source:source})).catch(e=>{o({statusCode:e.statusCode,message:e.message})}),methods:{openCreateDialog(){this.showDialog=!0}}},m=Object(d.a)(c,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"bangumi-video-flow"}},[e.bangumi.is_leader||e.bangumi.is_master?o("el-alert",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"info",title:""}},[e._v("\n    版主和代行者有权限上传百度云资源的视频，请勿引用包含广告的资源，违者抹杀（笑 \n    "),o("el-button",{attrs:{type:"primary",size:"mini",plain:"",round:""},on:{click:e.openCreateDialog}},[e._v("\n      添加视频\n    ")])],1):e._e(),e._ssrNode(" "),e.source.total?e._ssrNode("<section>","</section>",[e.source.has_season?e._ssrNode("<div>","</div>",e._l(e.source.videos,function(t){return e._ssrNode("<div>","</div>",[e._ssrNode('<h3 class="celltitle">'+e._ssrEscape(e._s(t.name))+"</h3> "),e._ssrNode("<ul>","</ul>",e._l(t.data,function(video){return o("video-flow-item",{key:video.id,attrs:{item:video,"bangumi-id":e.id}})}),1)],2)}),0):e._ssrNode("<ul>","</ul>",e._l(e.source.videos[0].data,function(video){return o("video-flow-item",{key:video.id,attrs:{item:video,"bangumi-id":e.id}})}),1)]):e._e(),e._ssrNode(" "),o("v-dialog",{attrs:{footer:!1,title:"新建视频"},model:{value:e.showDialog,callback:function(t){e.showDialog=t},expression:"showDialog"}},[o("edit-video-form",{attrs:{"bangumi-id":e.id,season:e.computedSeason}})],1)],2)},[],!1,null,null,"3ab1daea");t.default=m.exports}};
//# sourceMappingURL=video.chunk.fbe3ca26.js.map
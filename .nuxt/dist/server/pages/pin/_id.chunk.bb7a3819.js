exports.ids=[30],exports.modules={229:function(t,e){t.exports={"image-preview":"image-preview-2_",imagePreview:"image-preview-2_",container:"container-34",bar:"bar-1j","top-bar":"top-bar-1d",topBar:"top-bar-1d","foot-bar":"foot-bar-AF",footBar:"foot-bar-AF",wrap:"wrap-tx",item:"item-32",close:"close-27",download:"download-51","next-btn":"next-btn-3T",nextBtn:"next-btn-3T","prev-btn":"prev-btn-12",prevBtn:"prev-btn-12"}},230:function(t,e){},231:function(t,e){},232:function(t,e){},233:function(t,e){},234:function(t,e){},235:function(t,e){},238:function(t,e,n){"use strict";var r={name:"CommentReplyForm",props:{type:{required:!0,type:String},id:{required:!0,type:Number},toUserId:{required:!0,type:Number},value:{type:Boolean,default:!1,required:!0}},data(){return{open:this.value,submitting:!1,content:""}},mounted(){this.$watch("value",t=>{this.open=t,t&&this.$nextTick(()=>{this.$refs.input.focus()})}),this.$watch("open",t=>{this.$emit("input",t)})},methods:{cancel(){this.open=!1},async submit(){if(this.$store.state.login){if(this.content&&!this.submitting){this.submitting=!0;try{const t=await this.$store.dispatch("comment/createSubComment",{id:this.id,ctx:this,type:this.type,content:this.content,targetUserId:this.toUserId});this.open=!1,this.content="",this.$toast.success(t.message),this.$store.commit("UPDATE_USER_EXP",t.exp)}catch(t){}finally{this.submitting=!1}}}else this.$channel.$emit("sign-in")}}},o=n(0);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.open?n("div",{staticClass:"comment-reply-form"},[t._ssrNode('<div class="btn-group">',"</div>",[n("el-button",{attrs:{size:"mini",type:"info",plain:""},on:{click:t.cancel}},[t._v("\n      取消\n    ")]),t._ssrNode(" "),n("el-button",{attrs:{loading:t.submitting,size:"mini",type:"primary"},on:{click:t.submit}},[t._v("\n      发表\n    ")])],2),t._ssrNode(' <div class="input-wrap"><input type="text" placeholder="请缩减至100字以内" maxlength="100"'+t._ssrAttr("value",t.content)+"></div>")],2):t._e()},[],!1,function(t){var e=n(246);e.__inject__&&e.__inject__(t)},null,"f8f6afc8");e.a=component.exports},243:function(t,e){},244:function(t,e,n){"use strict";var r=n(238),o={name:"VSubCommentItem",components:{CommentReplyForm:r.a},props:{comment:{required:!0,type:Object},parentUserId:{required:!0,type:Number},type:{required:!0,type:String,default:""}},data:()=>({showReplyArea:!1,deleting:!1}),computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},isMine(){return this.currentUserId===this.comment.from_user_id},canDelete(){return this.isMine||this.currentUserId===this.parentUserId},focusThisComment(){return parseInt(this.$route.query["reply-id"])===this.comment.id}},methods:{openReplyForm(){this.currentUserId?this.showReplyArea=!this.showReplyArea:this.$channel.$emit("sign-in")},deleteComment(){this.deleting||(this.deleting=!0,this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.dispatch("comment/deleteSubComment",{ctx:this,type:this.type,id:this.comment.id,parentId:this.comment.parent_id})}).catch(t=>{this.deleting=!1,"cancel"!==t&&this.$toast.error(t)}))}}},l=n(0);var c={name:"VSubCommentList",components:{SubCommentItem:Object(l.a)(o,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sub-comment-item",class:{"focused-sub-comment":t.focusThisComment},attrs:{id:"sub-comment-"+t.comment.id}},[t._ssrNode('<div class="sub-user">',"</div>",[t._ssrNode('<div class="avatar">',"</div>",[n("user-card",{attrs:{id:t.comment.from_user_id,zone:t.comment.from_user_zone}},[n("v-img",{attrs:{src:t.comment.from_user_avatar,avatar:!0,width:"24",height:"24"}})],1)],1)]),t._ssrNode(" "),t._ssrNode('<div class="sub-body">',"</div>",[n("user-card",{attrs:{id:t.comment.from_user_id,zone:t.comment.from_user_zone,"custom-class":"from-user href-fade-blue"}},[t._v("\n      "+t._s(t.comment.from_user_name)+"\n    ")]),t._ssrNode(" "),t._ssrNode('<span class="sub-text">',"</span>",[t.comment.to_user_id&&t.comment.to_user_id!==t.parentUserId?[t._ssrNode("\n        回复\n        "),n("user-card",{attrs:{id:t.comment.to_user_id,zone:t.comment.to_user_zone,"custom-class":"to-user"}},[t._v("\n          @"+t._s(t.comment.to_user_name)+"\n        ")])]:t._e(),t._ssrNode(t._ssrEscape("\n      "+t._s(t.comment.content)+"\n    "))],2),t._ssrNode(" "),t._ssrNode('<div class="sub-extra">',"</div>",[n("el-tooltip",{attrs:{content:t.comment.created_at,placement:"top",effect:"dark"}},[n("v-time",{model:{value:t.comment.created_at,callback:function(e){t.$set(t.comment,"created_at",e)},expression:"comment.created_at"}})],1),t._ssrNode(' <button class="reply-btn">\n        回复\n      </button> '),t.canDelete?t._ssrNode("<button>","</button>",[t._ssrNode('<i class="iconfont icon-shanchu"></i>')],2):n("report-dialog",{attrs:{id:t.comment.id,type:t.type+"_reply"}},[n("button",{staticClass:"reply-btn"},[t._v("\n          举报\n        ")])])],2),t._ssrNode(" "),n("comment-reply-form",{attrs:{id:t.comment.parent_id,type:t.type,"to-user-id":t.comment.from_user_id},model:{value:t.showReplyArea,callback:function(e){t.showReplyArea=e},expression:"showReplyArea"}})],2)],2)},[],!1,function(t){var e=n(247);e.__inject__&&e.__inject__(t)},null,"984d8742").exports},props:{parentComment:{required:!0,type:Object},type:{required:!0,type:String,default:""}},data:()=>({loading:!1,showCollapse:!1,collapsed:!1}),computed:{comments(){return this.parentComment.comments},authorId(){return this.parentComment.from_user_id},filterComments(){if(!this.collapsed)return this.comments.list;const data=this.comments,t=data.list,e=t.slice(0,5);if(t.every(t=>t.id<=data.maxId))return e;const n=e.map(t=>t.id);return e.concat(t.filter(t=>t.id>data.maxId&&-1===n.indexOf(t.id)))}},methods:{async loadMore(){if(!this.loading){this.loading=!0;try{await this.$store.dispatch("comment/getSubComments",{ctx:this,type:this.type,id:this.parentComment.id}),this.showCollapse=!0}catch(t){}finally{this.loading=!1}}}}};var m={name:"VCommentItem",components:{SubCommentList:Object(l.a)(c,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sub-comment-list-wrap"},[t._l(t.filterComments,function(e){return n("sub-comment-item",{key:e.id,attrs:{comment:e,"parent-user-id":t.authorId,type:t.type}})}),t._ssrNode(" "+(!t.comments.noMore||t.comments.list.length>5?'<div class="view-more">\n    共<strong>'+t._ssrEscape(t._s(t.comments.total))+"</strong>条回复\n    "+(t.comments.noMore?"\x3c!----\x3e":'\n      ，\n      <button class="more-btn">\n        查看更多\n      </button>')+" "+(t.showCollapse?'<button class="collapse-btn">'+t._ssrEscape("\n      "+t._s(t.collapsed?"展开":"收起")+"\n    ")+"</button>":"\x3c!----\x3e")+"</div>":"\x3c!----\x3e"))],2)},[],!1,function(t){var e=n(248);e.__inject__&&e.__inject__(t)},null,"8442972c").exports,CommentReplyForm:r.a},props:{comment:{required:!0,type:Object},masterId:{required:!0,type:[Number,String]},type:{required:!0,type:String,default:""}},data:()=>({deleting:!1,liking:!1,showReplyArea:!1}),computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},authorId(){return this.comment.from_user_id},isMine(){return this.currentUserId===this.authorId},canDelete(){return this.isMine||this.currentUserId===this.masterId},focusThisComment(){return parseInt(this.$route.query["comment-id"])===this.comment.id}},methods:{async toggleLike(){if(this.currentUserId){if(!this.liking){this.liking=!0;try{await this.$store.dispatch("comment/toggleLikeMainComment",{ctx:this,type:this.type,id:this.comment.id})}catch(t){}finally{this.liking=!1}}}else this.$channel.$emit("sign-in")},deleteComment(){this.deleting||(this.deleting=!0,this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.dispatch("comment/deleteMainComment",{ctx:this,type:this.type,id:this.comment.id}),this.$emit("delete")}).catch(t=>{this.deleting=!1,"cancel"!==t&&this.$toast.error(t)}))},replyComment(){this.currentUserId?this.showReplyArea=!this.showReplyArea:this.$channel.$emit("sign-in")}}};var d=Object(l.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"def-comment-item",class:{"focused-main-comment":t.focusThisComment},attrs:{id:"comment-"+t.comment.id}},[t._ssrNode('<div class="user">',"</div>",[n("user-card",{attrs:{id:t.comment.from_user_id,zone:t.comment.from_user_zone}},[n("v-img",{staticClass:"avatar",attrs:{src:t.comment.from_user_avatar,avatar:!0,width:"48",height:"48"}})],1)],1),t._ssrNode(" "),t._ssrNode('<div class="body">',"</div>",[t._ssrNode('<div class="header">',"</div>",[t._ssrNode("<a"+t._ssrAttr("href",t.$alias.user(t.comment.from_user_zone))+' target="_blank" class="blue-link">'+t._ssrEscape(t._s(t.comment.from_user_name))+"</a> "+(t.comment.is_owner?"<span>(楼主)</span>":"\x3c!----\x3e")+" "),t.comment.is_leader?n("el-tooltip",{attrs:{placement:"top",effect:"dark",content:"版主"}},[n("i",{staticClass:"iconfont icon-leader"})]):t.comment.is_master?n("el-tooltip",{attrs:{placement:"top",effect:"dark",content:"代行者"}},[n("i",{staticClass:"iconfont icon-master"})]):t._e()],2),t._ssrNode(' <div class="content">'+t._s(t.comment.content)+"</div> "),t._ssrNode('<div class="footer">',"</div>",[t._ssrNode('<span class="floor-count">'+t._ssrEscape("#"+t._s(t.comment.floor_count-1))+"</span> "),n("el-tooltip",{attrs:{content:t.comment.created_at,placement:"top",effect:"dark"}},[n("v-time",{attrs:{datetime:t.comment.created_at}})],1),t._ssrNode(' <button class="like-btn"><i'+t._ssrClass("iconfont",[t.comment.liked?"icon-dianzan-active":"icon-dianzan"])+"></i> "+(t.comment.like_count?"<span>"+t._ssrEscape(t._s(t.comment.like_count))+"</span>":"\x3c!----\x3e")+'</button> <button class="reply-btn">\n        回复\n      </button> '),t.canDelete?t._ssrNode('<button class="delete-btn">',"</button>",[t._ssrNode('<i class="iconfont icon-shanchu"></i>')],2):n("report-dialog",{attrs:{id:t.comment.id,type:t.type+"_comment"}},[n("button",{staticClass:"reply-btn main-comment-report-btn"},[t._v("\n          举报\n        ")])])],2),t._ssrNode(" "),n("comment-reply-form",{attrs:{id:t.comment.id,"to-user-id":t.authorId,type:t.type},model:{value:t.showReplyArea,callback:function(e){t.showReplyArea=e},expression:"showReplyArea"}}),t._ssrNode(" "),n("sub-comment-list",{attrs:{"parent-comment":t.comment,type:t.type}})],2)],2)},[],!1,function(t){var e=n(249);e.__inject__&&e.__inject__(t)},null,"8deb9696").exports,h={name:"CreateCommentForm",props:{type:{type:String,required:!0},id:{type:[Number,String],required:!0},masterId:{type:Number,required:!0}},data:()=>({content:""}),computed:{isGuest(){return!this.$store.state.login},submitting(){return this.$store.state.comment.submitting},userAvatar(){return this.isGuest?"https://image.calibur.tv/default/user-avatar":this.$store.state.user.avatar}},methods:{async submit(){if(this.isGuest)return this.$toast.info("继续操作前请先登录"),void this.$channel.$emit("sign-in");if(this.content&&!this.submitting){this.$store.commit("comment/SET_SUBMITTING",{result:!0});try{const t=await this.$store.dispatch("comment/createMainComment",{content:this.content,images:[],type:this.type,id:this.id,ctx:this});this.content="",this.withImage&&this.$refs.uploader.clearFiles(),this.$toast.success(t.message),this.$store.commit("UPDATE_USER_EXP",t.exp),window.__closeImageLazy__||setTimeout(()=>{const e=document.getElementById(`comment-${t.data.id}`);e&&this.$scrollToY(this.$utils.getOffsetTop(e)-200,600)},400),this.$emit("submit")}catch(t){}finally{this.$store.commit("comment/SET_SUBMITTING",{result:!1})}}},handleTextAreaFocus(){this.isGuest&&this.$channel.$emit("sign-in")}}};var _={name:"CommentMain",components:{CommentCreateForm:Object(l.a)(h,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"create-comment-form"},[e("v-img",{staticClass:"avatar",attrs:{src:this.userAvatar,avatar:!0,width:"48",height:"48"}}),this._ssrNode(' <div class="main-area"><button class="submit-btn">\n      发表<br>评论\n    </button> <div class="text-wrap"><textarea placeholder="请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。" maxlength="1000"></textarea></div></div>')],2)},[],!1,function(t){var e=n(250);e.__inject__&&e.__inject__(t)},null,"0c39bf82").exports,CommentItem:d},props:{id:{required:!0,type:[Number,String]},type:{required:!0,type:String,validator:t=>~["post","video","image","score","question","answer","role"].indexOf(t)},onlySeeMaster:{type:Boolean,default:!1},masterId:{type:[Number,String],required:!0},emptyText:{type:String,default:"暂无评论，快来抢沙发吧╮(￣▽￣)╭！"},auto:{type:Boolean,default:!1},lazy:{type:Boolean,default:!1},showHeader:{type:Boolean,default:!0}},data:()=>({loading:!1}),computed:{store(){return this.$store.state.comment},list(){return this.store.list},noMore(){return this.store.noMore},total(){return this.store.total}},mounted(){this.auto&&this.$channel.$on(`fire-load-comment-${this.type}-${this.id}`,()=>{this.loadMore(!0)}),this.lazyLoadComment()},methods:{async loadMore(t=!1){if(!this.loading){this.loading=!0;try{await this.$store.dispatch("comment/getMainComments",{ctx:this,type:this.type,id:this.id,onlySeeMaster:this.onlySeeMaster?1:0,firstRequest:t})}catch(t){}finally{this.loading=!1}}},async lazyLoadComment(){if(!this.lazy)return void this.$nextTick(()=>{this.scrollToReply()});const{query:t}=this.$route;await this.$store.dispatch("comment/getMainComments",{id:this.id,type:this.type,seeReplyId:t["comment-id"],onlySeeMaster:t.only&&parseInt(t.only,10)?1:0}),this.$nextTick(()=>{this.scrollToReply()})},scrollToReply(){const t=this.$route.query["comment-id"];if(!t)return;const e=document.getElementById(`comment-${t}`);e&&this.$nextTick(()=>{this.$scrollToY(this.$utils.getOffsetTop(e)-200,400)})}}};var f=Object(l.a)(_,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"comment-wrap"}},[t._t("header",[t.showHeader?n("h3",{staticClass:"sub-title"},[t._v("\n      评论"+t._s(t.total?"("+t.total+")":"")+"\n    ")]):t._e(),t._v(" "),n("comment-create-form",{attrs:{id:t.id,type:t.type,"master-id":t.masterId},on:{submit:function(e){return t.$emit("create-main-comment")}}})]),t._ssrNode(" "),t.list.length?t._ssrNode('<div id="comment-list-wrap">',"</div>",t._l(t.list,function(e){return t._ssrNode('<div class="comment-item-wrap">',"</div>",[t._t("comment-item",[n("comment-item",{attrs:{comment:e,type:t.type,"master-id":t.masterId},on:{delete:function(e){return t.$emit("delete-main-comment")}}})],{comment:e})],2)}),0):t.emptyText?t._ssrNode('<p class="no-content">'+t._ssrEscape(t._s(t.emptyText))+"</p>"):t._e(),t._ssrNode(" "),t._ssrNode('<div id="comment-list-footer">',"</div>",[t._ssrNode('<div class="load-more-btn">',"</div>",[t.noMore?t._e():n("el-button",{attrs:{loading:t.loading,type:"info",plain:"",round:""},on:{click:function(e){return t.loadMore(!1)}}},[t._v("\n        "+t._s(t.loading?"加载中...":"加载更多")+"\n      ")])],1),t._ssrNode(" "),t._t("reply",[t.list.length>=10?n("comment-create-form",{attrs:{id:t.id,type:t.type,"master-id":t.masterId},on:{submit:function(e){return t.$emit("create-main-comment")}}}):t._e()])],2)],2)},[],!1,function(t){var e=n(251);e.__inject__&&e.__inject__(t)},null,"7259fc5b");e.a=f.exports},245:function(t,e,n){"use strict";n.r(e);var r=n(229),o=n.n(r);for(var l in r)"default"!==l&&function(t){n.d(e,t,function(){return r[t]})}(l);e.default=o.a},246:function(t,e,n){"use strict";n.r(e);var r=n(230),o=n.n(r);for(var l in r)"default"!==l&&function(t){n.d(e,t,function(){return r[t]})}(l);e.default=o.a},247:function(t,e,n){"use strict";n.r(e);var r=n(231),o=n.n(r);for(var l in r)"default"!==l&&function(t){n.d(e,t,function(){return r[t]})}(l);e.default=o.a},248:function(t,e,n){"use strict";n.r(e);var r=n(232),o=n.n(r);for(var l in r)"default"!==l&&function(t){n.d(e,t,function(){return r[t]})}(l);e.default=o.a},249:function(t,e,n){"use strict";n.r(e);var r=n(233),o=n.n(r);for(var l in r)"default"!==l&&function(t){n.d(e,t,function(){return r[t]})}(l);e.default=o.a},250:function(t,e,n){"use strict";n.r(e);var r=n(234),o=n.n(r);for(var l in r)"default"!==l&&function(t){n.d(e,t,function(){return r[t]})}(l);e.default=o.a},251:function(t,e,n){"use strict";n.r(e);var r=n(235),o=n.n(r);for(var l in r)"default"!==l&&function(t){n.d(e,t,function(){return r[t]})}(l);e.default=o.a},252:function(t,e,n){"use strict";var r={name:"ImagePreview",props:{images:{type:Array,default:()=>[]},query:{type:String,default:""},download:{type:Boolean,default:!0}},data(){return{show:!1,currentIndex:-1,maxWidth:0,maxHeight:0,displayImages:this.images.map(t=>Object.assign({finalWidth:0,finalHeight:0,loading:!0},t))}},computed:{total(){return this.images.length},currentImage(){return-1===this.currentIndex?null:this.displayImages[this.currentIndex]}},mounted(){this.getScreenSize(),window.addEventListener("resize",this.getScreenSize)},methods:{handleClose(){this.show=!1},handleClick(t){if(!this.total)return;const e=t.target||t.currentTarget,n="img"===e.tagName.toLowerCase();if(!this.query&&!n)return;if(this.query&&-1===e.className.indexOf(this.query))return;let r="";if(n)r=e.getAttribute("src").split("?")[0];else{const img=e.querySelector("img");if(!img)return;r=img.getAttribute("src").split("?")[0]}this.getClickImageIndex(r),this.computeDisplaySize(this.currentIndex),this.show=!0},getClickImageIndex(t){this.images.forEach((image,e)=>{image.url===t&&(this.currentIndex=e)})},getScreenSize(){this.maxWidth=window.innerWidth,this.maxHeight=window.innerHeight-88},switchImage(t){if(t&&this.currentIndex===this.total-1)return;if(!t&&0===this.currentIndex)return;const e=t?this.currentIndex+1:this.currentIndex-1;this.computeDisplaySize(e),this.currentIndex=e},getSiblingsIndex(t){let e,n;return 0===this.currentIndex?(e=this.total-1,n=1):this.currentIndex===this.total-1?(e=this.total-2,n=0):(e=this.currentIndex-1,n=this.currentIndex+1),[e,t,n]},computeDisplaySize(t){if(void 0===this.images[t])return;const image=this.images[t];if(image.finalWidth&&image.finalHeight)return;const e=image.width,n=image.height,r=this.maxWidth,o=this.maxHeight;let l,c;if(r>=e&&o>=n)l=e,c=n;else if(r<e&&o<n){const t=e/o,m=n/o;t>=m?(l=r,c=parseInt(n/t,10)):(l=parseInt(e/m,10),c=o)}else if(n<o){l=r,c=parseInt(n/(e/o),10)}else{l=parseInt(e/(n/o),10),c=o}this.displayImages[t].finalWidth=l||r,this.displayImages[t].finalHeight=c||o},handleSwitch(t,e){this.currentIndex=e}}},o=n(0);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{class:t.$style.imagePreview,on:{click:t.handleClick}},[t._ssrNode((t.show?"<div"+t._ssrClass(null,t.$style.container)+"><div"+t._ssrClass(null,[t.$style.bar,t.$style.topBar])+">"+(t.total?"<span"+t._ssrClass(null,t.$style.total)+">"+t._ssrEscape("\n        "+t._s(t.currentIndex+1)+"/"+t._s(t.total)+"\n      ")+"</span>":"\x3c!----\x3e")+" <span"+t._ssrClass(null,t.$style.close)+">\n        ×\n      </span></div> <div"+t._ssrClass(null,[t.$style.bar,t.$style.footBar])+">"+(t.currentImage&&t.download?"<a"+t._ssrAttr("href",t.currentImage.url)+' target="_blank"'+t._ssrClass(null,t.$style.download)+">\n        下载原图\n      </a>":"\x3c!----\x3e")+"</div> "+(t.currentImage?"<div"+t._ssrClass(null,t.$style.wrap)+"><div"+t._ssrClass(null,t.$style.item)+t._ssrStyle(null,{backgroundImage:"url("+t.$resize(t.currentImage.url,{webP:!t.download})+")",width:t.currentImage.finalWidth+"px",height:t.currentImage.finalHeight+"px"},null)+"></div> "+(t.total>1?"<button"+t._ssrClass(null,t.$style.prevBtn)+'><i class="el-icon-caret-left"></i></button> <button'+t._ssrClass(null,t.$style.nextBtn)+'><i class="el-icon-caret-right"></i></button>':"\x3c!----\x3e")+"</div>":"\x3c!----\x3e")+"</div>":"\x3c!----\x3e")+" "),t._t("default")],2)},[],!1,function(t){var e=n(245);e.__inject__&&e.__inject__(t),this.$style=e.locals||e},null,"9fce79ee");e.a=component.exports},275:function(t,e){},276:function(t,e,n){"use strict";n.r(e);var r=n(243),o=n.n(r);for(var l in r)"default"!==l&&function(t){n.d(e,t,function(){return r[t]})}(l);e.default=o.a},281:function(t,e,n){"use strict";var r={name:"SocialPanel",props:{isCreator:{required:!0,type:Boolean},isMine:{required:!0,type:Boolean},id:{required:!0,type:Number},type:{required:!0,type:String,validator:t=>~["post","video","image","score","answer","video"].indexOf(t)}},computed:{isAuth(){return this.$store.state.isAuth},isGuest(){return!this.$store.state.login},source(){return this.$store.getters["social/getState"](this.type,this.id)}},methods:{computeTextByAction:t=>"reward"===t?"投食":"like"===t?"喜欢":"mark"===t?"收藏":"操作",toggleAction(t){if(this.isGuest)this.$channel.$emit("sign-in");else if(this.isMine)this.$toast.info(`不能${this.computeTextByAction(t)}自己的内容`);else if("reward"===t){if(this.source.reward)return void this.$toast.info("已投食过");this.$confirm("向TA投食需要消耗你一个团子，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.submitAction("reward")}).catch(()=>{})}else this.submitAction(t)},async submitAction(t){const data=await this.$store.dispatch("social/toggleAction",{type:this.type,id:this.id,action:t});data.success&&this.$emit(`${t}-callback`,{result:data.result})}}},o=n(0);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.source?n("div",{staticClass:"what-the-ad-block-fucked-panel"},[t._ssrNode('<div class="dont-block-me-please-buttons">',"</div>",[t._t("default"),t._ssrNode(" "),t.isCreator?n("el-button",{class:{"is-plain":t.source.reward},attrs:{loading:t.source.reward_loading,type:"warning",icon:"iconfont icon-fantuan",round:""},on:{click:function(e){return t.toggleAction("reward")}}},[t._v("\n      "+t._s(t.source.reward?"已投食":"投食")+t._s(t.source.reward_users.total?"  |  "+t.source.reward_users.total:"")+"\n    ")]):t._e(),t._ssrNode(" "),n("el-button",{class:{"is-plain":t.source.like},attrs:{loading:t.source.like_loading,type:"danger",icon:"iconfont icon-like",round:""},on:{click:function(e){return t.toggleAction("like")}}},[t._v("\n      "+t._s(t.source.like?"已喜欢":"喜欢")+t._s(t.source.like_users.total?"  |  "+t.source.like_users.total:"")+"\n    ")]),t._ssrNode(" "),n("el-button",{class:{"is-plain":t.source.mark},attrs:{loading:t.source.mark_loading,type:"success",icon:"iconfont icon-mark",round:""},on:{click:function(e){return t.toggleAction("mark")}}},[t._v("\n      "+t._s(t.source.mark?"已收藏":"收藏")+t._s(t.source.mark_users.total?"  |  "+t.source.mark_users.total:"")+"\n    ")])],2),t._ssrNode(" "),t._ssrNode('<div class="users">',"</div>",[n("ava-dialog",{attrs:{id:t.id,title:t.isCreator?"投食的人":"喜欢的人",action:t.isCreator?"reward":"like",type:t.type}})],1)],2):t._e()},[],!1,function(t){var e=n(276);e.__inject__&&e.__inject__(t)},null,"7ba00a31");e.a=component.exports},358:function(t,e,n){"use strict";n.r(e);var r=n(275),o=n.n(r);for(var l in r)"default"!==l&&function(t){n.d(e,t,function(){return r[t]})}(l);e.default=o.a},359:function(t,e){},396:function(t,e,n){"use strict";var r={name:"VParts",props:{list:{type:Array,required:!0},alias:{type:Function,required:!0},value:{type:Boolean,default:!1},isFirst:{type:Boolean,default:!0},forceAll:{type:Boolean,default:!1},allData:{type:Array,required:!0}},data(){return{maxWidth:0,take:0,part:0,page:0,showAll:this.value}},computed:{id(){return parseInt(this.$route.params.id,10)},filterList(){if(this.forceAll||this.showAll)return this.list;const t=(this.page-1)*this.take;return this.list.slice(t,t+this.take)},showMoreBtn(){return this.forceAll?this.forceAll&&this.isFirst:this.isFirst&&this.take<this.list.length}},watch:{value(t){this.showAll=t},showAll(t){this.$emit("input",t)}},mounted(){this.computeMaxWidth(),this.$watch("list",()=>{this.computeMaxWidth()})},methods:{computeMaxWidth(){let t=0;this.allData.forEach(video=>{const e=video.name.replace(/([\u4e00-\u9fa5])/g,"aa").trim().length;t<e&&(t=e)}),this.maxWidth=46+8*t,this.$nextTick(()=>{this.computePage()})},computePage(){try{this.take=2*Math.floor(this.$el.offsetWidth/(this.maxWidth+8))}catch(t){this.take=5}this.list.forEach((t,e)=>{t.id===this.id&&(this.part=e+1)}),this.page=Math.ceil(this.part/this.take)},handleFilter(){this.showAll=!this.showAll}}},o=n(0);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.maxWidth?n("ul",{staticClass:"v-parts"},[t._l(t.filterList,function(e){return t._ssrNode("<li>","</li>",[t._ssrNode("<a"+t._ssrAttr("href",t.alias(e.id))+t._ssrClass("oneline",{active:t.id===e.id})+t._ssrStyle(null,{width:t.maxWidth+"px"},null)+">","</a>",[t._t("default",null,{item:e})],2)])}),t._ssrNode(" "+(t.showMoreBtn?'<button class="more">'+t._ssrEscape("\n    "+t._s(t.showAll?"收起":"展开")+"\n  ")+"</button>":"\x3c!----\x3e"))],2):t._e()},[],!1,function(t){var e=n(358);e.__inject__&&e.__inject__(t)},null,"501cad58");e.a=component.exports},453:function(t,e,n){"use strict";n.r(e);var r=n(359),o=n.n(r);for(var l in r)"default"!==l&&function(t){n.d(e,t,function(){return r[t]})}(l);e.default=o.a},496:function(t,e,n){"use strict";n.r(e);var r=n(396),o=n(244),l=n(6),c=n(5),m={name:"EditAlbumForm",mixins:[l.a],props:{bangumiId:{required:!0,type:Number},albumId:{required:!0,type:Number},album:{required:!0,type:Object}},data(){return{submitting:!1,form:{id:this.albumId,bangumi_id:this.bangumiId,name:this.album.name,is_cartoon:this.album.is_cartoon,is_creator:this.album.is_creator,part:this.album.part,poster:this.album.source}}},computed:{isCartoon(){return this.form.is_cartoon},currentUserId(){return this.$store.state.user.id}},methods:{async submit(){if(!this.form.poster)return void this.$toast.error("必须选择一个封面");const t=this.form.name;if(t){if(t.length>30)this.$toast.error("名字不能超过 30 个字");else if(!this.submitting){this.submitting=!0;try{await Object(c.d)(this,Object.assign({},this.form,this.form.poster,{url:this.form.poster.url.split("calibur.tv/").pop()})),this.$toast.success("操作成功"),setTimeout(()=>{window.location.reload()},1e3)}catch(t){}finally{this.submitting=!1}}}else this.$toast.error("名字不能为空")},beforePosterUpload(t){return this.uploadConfig.max=3,this.uploadConfig.pathPrefix=`user/${this.currentUserId}/album`,this.beforeImageUpload(t)},handleAlbumUploadSuccess(t){this.form.poster=t.data,this.$toast.success("封面上传成功")},handlePosterRemove(){this.form.poster=null}}},d=n(0),h=Object(d.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form",{attrs:{disabled:t.submitting,"label-width":"45px"}},[n("el-form-item",{attrs:{label:"名字",prop:"name"}},[n("el-input",{attrs:{placeholder:t.isCartoon?"填写这一话的名字":"给相册起一个名字"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),t.isCartoon?n("el-form-item",{attrs:{label:"集数",prop:"part"}},[n("el-input-number",{attrs:{min:1},model:{value:t.form.part,callback:function(e){t.$set(t.form,"part",e)},expression:"form.part"}})],1):t._e(),t._v(" "),n("el-form-item",{attrs:{label:"封面",prop:"poster"}},[t.form.poster?n("img",{staticStyle:{width:"auto"},attrs:{src:t.$resize(t.form.poster.url),height:"200"}}):t._e(),t._v(" "),n("el-upload",{ref:"upload",attrs:{data:t.uploadHeaders,"on-error":t.handleImageUploadError,"on-success":t.handleAlbumUploadSuccess,"before-upload":t.beforePosterUpload,"on-remove":t.handlePosterRemove,action:t.imageUploadAction,accept:t.imageUploadAccept}},[n("el-button",{attrs:{loading:t.submitting,size:"small",round:""}},[t._v("\n        上传封面\n      ")])],1)],1),t._v(" "),n("el-form-item",[n("el-button",{attrs:{loading:t.submitting,type:"primary",size:"small"},on:{click:t.submit}},[t._v("\n      确认提交\n    ")])],1)],1)},[],!1,null,null,"6d493327").exports,_={name:"EditImageForm",props:{image:{type:Object,required:!0}},data(){return{submitting:!1,form:{bangumi_id:this.image.bangumi_id,name:this.image.name}}},methods:{async submit(){if(this.form.name.length>30)this.$toast.error("名字最长 30 个字");else if(!this.submitting){this.submitting=!1;try{await Object(c.e)(this,{id:this.image.id,name:this.form.name,bangumi_id:this.form.bangumi_id}),this.$toast.success("操作成功"),setTimeout(()=>{window.location.reload()},1e3)}catch(t){}finally{this.submitting=!1}}}}},f=Object(d.a)(_,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form",{attrs:{disabled:t.submitting,"label-width":"45px"}},[n("el-form-item",{attrs:{label:"名字"}},[n("el-input",{attrs:{placeholder:"给图片起个名字"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"番剧"}},[n("bangumi-search",{attrs:{clear:!1},model:{value:t.form.bangumi_id,callback:function(e){t.$set(t.form,"bangumi_id",e)},expression:"form.bangumi_id"}})],1),t._v(" "),n("el-form-item",[n("el-button",{attrs:{loading:t.submitting,type:"primary",size:"small"},on:{click:t.submit}},[t._v("\n      确认编辑\n    ")])],1)],1)},[],!1,null,null,"5606b213").exports,v=n(281),y=n(252),$={name:"ImageShow",validate:({params:t})=>/^\d+$/.test(t.id),components:{vParts:r.a,CommentMain:o.a,EditAlbumForm:h,EditImageForm:f,SocialPanel:v.a,ImagePreview:y.a},props:{id:{type:String,required:!0}},data:()=>({info:null,user:null,source:null,bangumi:[],images:[],loadingEditImages:!1,showAllPart:!1,openEditModal:!1}),computed:{cartoon:()=>[],isMine(){return!!this.$store.state.login&&this.user.id===this.$store.state.user.id},editable(){return!!this.$store.state.login&&this.user.id===this.$store.state.user.id},albumType(){return this.info.is_album?this.info.is_cartoon?"漫画":"相册":"图片"}},asyncData({app:t,store:e,params:n,query:r,error:o}){const{id:l}=n,{hash:m,time:time}=r;return Object(c.f)(t,{id:l,hash:m,time:time}).then(t=>{const{bangumi:n}=t;return e.commit("social/SET_STATE",{type:"image",id:l,data:{like:t.liked,reward:t.rewarded,mark:t.marked,like_users:t.like_users,mark_users:t.mark_users,reward_users:t.reward_users}}),e.commit("social/SET_STATE",{type:"bangumi",id:n.id,data:{follow:n.followed}}),{info:t,bangumi:n,user:t.user,source:t.source,images:t.images}}).catch(t=>{o({statusCode:t.statusCode,message:t.message})})},head(){return{title:this.info.name}},methods:{async handleSortBtnClick(t,e){if(this.loadingEditImages)this.$toast.error("正在操作，请稍候...");else{this.loadingEditImages=!0;try{const n=e?t:t-1,r=e?t+1:t,o=this.images.map(t=>t);o.splice(n,1,...o.splice(r,1,o[n]));const l=o.map(t=>t.id).toString();await Object(c.i)(this,{id:this.id,result:l}),this.images=o,this.$toast.success("操作成功")}catch(t){}finally{this.loadingEditImages=!1}}},handleImageDelete(t){this.loadingEditImages?this.$toast.error("正在操作，请稍候..."):this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{this.loadingEditImages=!0;try{const e=this.images.map(t=>t.id),n=e.splice(t,1)[0];await Object(c.c)(this,{id:this.id,result:e.toString(),imageId:n}),this.images.splice(t,1),this.info.image_count--,this.$toast.success("操作成功")}catch(t){}finally{this.loadingEditImages=!1}}).catch(()=>{})},handleDeleteAlbum(){this.$prompt(`请输入${this.albumType}的名字`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:t})=>{t===this.info.name?Object(c.b)(this,{id:this.info.id}).then(()=>{this.$toast.success("操作成功"),setTimeout(()=>{window.location.reload()},1e3)}).catch(t=>{this.$toast.error(t)}):this.$toast.error("名字不对")}).catch(()=>{})}}};var x=Object(d.a)($,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.info?n("div",{attrs:{id:"image-show"}},[t.info.is_cartoon?n("v-header",{staticClass:"image-banner",attrs:{banner:t.source.url,height:"400px",type:"mask"}},[n("div",{staticClass:"container"},[n("div",{staticClass:"panel"},[n("h1",{staticClass:"title"},[t._v("\n          《"+t._s(t.info.name)+"》\n        ")]),t._v(" "),n("p",{staticClass:"author"},[t._v("\n          UP：\n          "),n("a",{attrs:{href:t.$alias.user(t.user.zone),target:"_blank"},domProps:{textContent:t._s(t.user.nickname)}}),t._v("\n           ·  共："+t._s(t.info.image_count)+"张\n        ")])])]),t._v(" "),n("v-share",{attrs:{type:"panel"}})],1):n("v-header"),t._ssrNode(" "),n("v-layout",[t.info.deleted_at?n("el-alert",{attrs:{title:"该内容已被删除",type:"error",center:"","show-icon":""}}):t._e(),t._v(" "),n("nav",[t.editable&&t.isMine?n("div",{staticClass:"edit-area"},[n("el-button",{attrs:{round:"",plain:"",type:"primary",size:"mini"},on:{click:function(e){t.openEditModal=!0}}},[t._v("\n          编辑\n        ")]),t._v(" "),n("el-button",{attrs:{round:"",plain:"",type:"danger",size:"mini"},on:{click:t.handleDeleteAlbum}},[t._v("\n          删除\n        ")]),t._v(" "),n("v-dialog",{attrs:{title:"编辑"+t.albumType,footer:!1},model:{value:t.openEditModal,callback:function(e){t.openEditModal=e},expression:"openEditModal"}},[t.info.is_album?n("edit-album-form",{attrs:{"bangumi-id":t.bangumi.id,"album-id":t.info.id,album:t.info}}):n("edit-image-form",{attrs:{image:t.info}})],1)],1):t._e(),t._v(" "),n("h1",{staticClass:"breadcrumb"},[n("a",{attrs:{href:"/",target:"_blank"}},[t._v("主站")]),t._v(" "),t.bangumi?n("a",{attrs:{href:t.$alias.bangumi(t.bangumi.id),target:"_blank"},domProps:{textContent:t._s(t.bangumi.name)}}):t._e(),t._v(" "),t.info.is_album?t.info.is_cartoon?n("a",{attrs:{href:t.$alias.bangumi(t.bangumi.id,"cartoon"),target:"_blank"}},[t._v("漫画")]):n("a",{attrs:{href:t.$alias.bangumi(t.bangumi.id,"pins"),target:"_blank"}},[t._v("相册")]):n("a",{attrs:{href:"javascript:;"}},[t._v("图片")]),t._v("\n        "+t._s(t.info.name)+"\n      ")])]),t._v(" "),n("div",{staticClass:"images-wrap"},[t.info.is_album?n("image-preview",{attrs:{images:t.images}},[t._l(t.images,function(img,e){return n("div",{key:img.id,staticClass:"image-package",attrs:{id:"image-"+img.id}},[n("v-img",{staticClass:"image",attrs:{src:img.url,"img-width":img.width,"img-height":img.height}}),t._v(" "),t.editable?[n("button",{staticClass:"sort-btn delete-btn el-icon-close",on:{click:function(n){return t.handleImageDelete(e)}}}),t._v(" "),n("button",{staticClass:"sort-btn to-prev el-icon-caret-top",on:{click:function(n){return t.handleSortBtnClick(e,!1)}}}),t._v(" "),n("button",{staticClass:"sort-btn to-next el-icon-caret-bottom",on:{click:function(n){return t.handleSortBtnClick(e,!0)}}})]:t._e()],2)}),t._v(" "),t.info.image_count?t._e():n("p",{staticClass:"no-image"},[t._v("\n          还没有上传图片\n        ")])],2):n("image-preview",{attrs:{images:[t.source]}},[n("div",{staticClass:"image-package"},[n("v-img",{staticClass:"image",attrs:{src:t.source.url,"img-width":t.source.width,"img-height":t.source.height}})],1)])],1),t._v(" "),n("div",{staticClass:"album-footer"},[n("div",{staticClass:"publish-time"},[t._v("\n        UP：\n        "),n("user-card",{attrs:{id:t.user.id,zone:t.user.zone}},[t._v("\n          "+t._s(t.user.nickname)+"\n        ")]),t._v("\n         · \n        "),n("span",[t._v(" 发布于："),n("v-time",{model:{value:t.info.created_at,callback:function(e){t.$set(t.info,"created_at",e)},expression:"info.created_at"}})],1),t._v(" "),t.info.is_cartoon?n("a",{staticClass:"email",attrs:{href:"mailto:414927352@qq.com"}},[t._v("侵权申诉")]):t._e(),t._v(" "),n("report-dialog",{attrs:{id:t.id,type:"image"}},[t._v("\n          内容举报\n        ")])],1),t._v(" "),t.info.is_cartoon?n("v-parts",{attrs:{list:t.info.parts,alias:t.$alias.image,"all-data":t.info.parts},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.item;return n("span",{},[t._v(" "+t._s(r.part)+"："+t._s(r.name)+" ")])}}],null,!1,3605471796),model:{value:t.showAllPart,callback:function(e){t.showAllPart=e},expression:"showAllPart"}}):t._e(),t._v(" "),n("social-panel",{attrs:{id:t.info.id,"is-creator":t.info.is_creator,"is-mine":t.isMine,type:"image"}})],1),t._v(" "),n("v-lazy",[n("comment-main",{attrs:{id:t.id,"master-id":t.user.id,lazy:!0,type:"image"}})],1),t._v(" "),n("template",{slot:"aside"},[n("h3",{staticClass:"sub-title"},[t._v("\n        所属番剧\n      ")]),t._v(" "),n("bangumi-panel",{attrs:{id:t.bangumi.id,name:t.bangumi.name,avatar:t.bangumi.avatar,summary:t.bangumi.summary}})],1)],2)],2):t._e()},[],!1,function(t){var e=n(453);e.__inject__&&e.__inject__(t)},null,"ca16228c");e.default=x.exports}};
//# sourceMappingURL=_id.chunk.bb7a3819.js.map
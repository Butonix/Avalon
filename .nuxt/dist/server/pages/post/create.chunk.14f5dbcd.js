exports.ids=[33],exports.modules={288:function(t,e,o){"use strict";o.d(e,"c",function(){return r}),o.d(e,"a",function(){return n}),o.d(e,"d",function(){return l}),o.d(e,"b",function(){return c}),o.d(e,"h",function(){return m}),o.d(e,"f",function(){return d}),o.d(e,"g",function(){return f}),o.d(e,"e",function(){return h});const r=(t,{id:e,only:o,hash:r,time:time})=>t.$axios.$get(`post/${e}/show`,{params:{only:o,hash:r,time:time}}),n=(t,{title:title,bangumiId:e,content:content,images:o,tags:r,desc:desc,geetest:n,is_creator:l})=>t.$axios.$post("post/create",{title:title,bangumiId:e,content:content,images:o,tags:r,desc:desc,geetest:n,is_creator:l}),l=t=>t.$axios.$get("post/tags"),c=(t,{id:e})=>t.$axios.$post(`post/${e}/deletePost`),m=(t,{id:e})=>t.$axios.$post("post/manager/top/set",{id:e}),d=(t,{id:e})=>t.$axios.$post("post/manager/top/remove",{id:e}),f=(t,{id:e})=>t.$axios.$post("post/manager/nice/set",{id:e}),h=(t,{id:e})=>t.$axios.$post("post/manager/nice/remove",{id:e})},331:function(t,e){},433:function(t,e,o){"use strict";o.r(e);var r=o(331),n=o.n(r);for(var l in r)"default"!==l&&function(t){o.d(e,t,function(){return r[t]})}(l);e.default=n.a},523:function(t,e,o){"use strict";o.r(e);var r=o(6),n=o(288),l={name:"PostCreate",mixins:[r.a],head:{title:"发帖"},data:()=>({showPostModal:!1,tags:[],forms:{title:"",bangumiId:"",content:"",tags:[],is_creator:!1},rules:{title:[{required:!0,max:40,message:"请输入帖子标题，最多40字",trigger:"submit"}],bangumiId:[{type:"number",required:!0,message:"请选择相应番剧",trigger:"submit"}],content:[{required:!0,max:8e3,message:"内容不能为空",trigger:"submit"}],tags:[{validator:(t,e,o)=>{if(e.length>3)return o(new Error("最多选择 3 个标签"));o()},trigger:"change"}]},images:[],exceed:6,loadingFetchBangumi:!1,submitting:!1}),computed:{bangumiId(){return"bangumi-show"===this.$route.name?parseInt(this.$route.params.id,10):0}},mounted(){this.getPostTags(),this.abortCloseWindow()},methods:{abortCloseWindow(){window.onbeforeunload=function(t){return(t=t||window.event)&&(t.returnValue="确定要关闭该页面吗?"),"确定要关闭该页面吗?"}},submit(){if(!this.$store.state.login)return this.$toast.info("继续操作前请先登录"),void this.$channel.$emit("sign-in");this.submitting||(this.submitting=!0,this.$refs.forms.validate(t=>{if(!t)return this.submitting=!1,!1;this.$captcha({ctx:this,success:async({data:data})=>{try{const t=await Object(n.a)(this,{title:this.forms.title,bangumiId:this.forms.bangumiId,tags:this.forms.tags,desc:this.forms.content.trim().substring(0,120),content:this.forms.content.trim(),images:this.images.map(t=>t.img),is_creator:this.forms.is_creator,geetest:data});this.$toast.success(t.message).then(()=>{window.location=this.$alias.post(t.data)})}catch(t){this.submitting=!1}},close:()=>{this.submitting=!1}})}))},handleError(t,e){console.log(t),this.images.forEach((t,o)=>{t.id===e.uid&&this.images.splice(o,1)}),this.$toast.error(`图片：${e.name} 上传失败`)},handleRemove(t){this.images.forEach((e,o)=>{e.id===t.uid&&this.images.splice(o,1)})},handleSuccess(t,e){this.images.push({id:e.uid,img:t.data})},handleExceed(){this.$toast.error(`最多可上传 ${this.exceed} 张图片!`)},beforeUpload(t){if(this.$store.state.login)return this.uploadConfig.max=5,this.uploadConfig.params={userId:this.$store.state.user.id,id:0,type:"post"},this.beforeImageUpload(t);this.$channel.$emit("sign-in")},async getPostTags(){if(!this.tags.length){try{const t=JSON.parse(sessionStorage.getItem("cache-post-tags"));if(t)return void(this.tags=t)}catch(t){}try{const t=await Object(n.d)(this);this.tags=t,sessionStorage.setItem("cache-post-tags",JSON.stringify(t))}catch(t){}}}}},c=o(0);var component=Object(c.a)(l,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"post-create"}},[o("v-header",{attrs:{type:"pure"}}),t._ssrNode(" "),t._ssrNode('<div class="center-layout">',"</div>",[o("el-form",{ref:"forms",staticClass:"create-post-form",attrs:{model:t.forms,rules:t.rules,"label-width":"42px"}},[o("el-form-item",{attrs:{label:"标题",prop:"title"}},[o("el-input",{attrs:{placeholder:"请填写帖子标题"},model:{value:t.forms.title,callback:function(e){t.$set(t.forms,"title","string"==typeof e?e.trim():e)},expression:"forms.title"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"番剧",prop:"bangumiId"}},[o("bangumi-search",{attrs:{followed:!0,placeholder:"请选择要投稿的番剧"},model:{value:t.forms.bangumiId,callback:function(e){t.$set(t.forms,"bangumiId",e)},expression:"forms.bangumiId"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"标签",prop:"tags"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"添加标签"},model:{value:t.forms.tags,callback:function(e){t.$set(t.forms,"tags",e)},expression:"forms.tags"}},t._l(t.tags,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),o("el-form-item",{attrs:{label:"原创"}},[o("el-switch",{model:{value:t.forms.is_creator,callback:function(e){t.$set(t.forms,"is_creator",e)},expression:"forms.is_creator"}}),t._v(" "),o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"如果帖子是转载的，请不要勾选",placement:"top"}},[o("i",{staticClass:"el-icon-question"})])],1),t._v(" "),o("el-form-item",{attrs:{label:"图片"}},[o("el-upload",{ref:"uploader",attrs:{data:t.uploadHeaders,action:t.imageUploadAction,accept:t.imageUploadAccept,"on-error":t.handleError,"on-remove":t.handleRemove,"on-success":t.handleSuccess,"on-exceed":t.handleExceed,limit:t.exceed,"before-upload":t.beforeUpload,multiple:"","list-type":"picture-card"}},[o("i",{staticClass:"el-icon-plus"})])],1),t._v(" "),o("el-form-item",{attrs:{label:"正文",prop:"content"}},[o("el-input",{attrs:{rows:7,type:"textarea"},model:{value:t.forms.content,callback:function(e){t.$set(t.forms,"content",e)},expression:"forms.content"}})],1),t._v(" "),o("el-form-item",[o("el-button",{attrs:{loading:t.submitting,type:"primary"},on:{click:t.submit}},[t._v("\n          发布\n        ")])],1)],1)],1)],2)},[],!1,function(t){var e=o(433);e.__inject__&&e.__inject__(t)},null,"c89c1176");e.default=component.exports}};
//# sourceMappingURL=create.chunk.14f5dbcd.js.map
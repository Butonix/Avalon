exports.ids=[37],exports.modules={232:function(t,e){t.exports={"image-preview":"image-preview-2_",imagePreview:"image-preview-2_",container:"container-34",bar:"bar-1j","top-bar":"top-bar-1d",topBar:"top-bar-1d","foot-bar":"foot-bar-AF",footBar:"foot-bar-AF",wrap:"wrap-tx",item:"item-32",close:"close-27",download:"download-51","next-btn":"next-btn-3T",nextBtn:"next-btn-3T","prev-btn":"prev-btn-12",prevBtn:"prev-btn-12"}},233:function(t,e){},234:function(t,e){},235:function(t,e){},236:function(t,e){},237:function(t,e){},238:function(t,e){},239:function(t,e,r){"use strict";r.d(e,"l",function(){return n}),r.d(e,"u",function(){return o}),r.d(e,"g",function(){return l}),r.d(e,"j",function(){return c}),r.d(e,"c",function(){return d}),r.d(e,"k",function(){return m}),r.d(e,"d",function(){return _}),r.d(e,"r",function(){return h}),r.d(e,"h",function(){return f}),r.d(e,"p",function(){return v}),r.d(e,"f",function(){return y}),r.d(e,"s",function(){return x}),r.d(e,"a",function(){return $}),r.d(e,"q",function(){return w}),r.d(e,"m",function(){return k}),r.d(e,"e",function(){return C}),r.d(e,"b",function(){return I}),r.d(e,"i",function(){return S}),r.d(e,"t",function(){return N}),r.d(e,"o",function(){return E}),r.d(e,"n",function(){return j});const n=(t,{id:e})=>t.$axios.$get(`cartoon_role/${e}/stock_show`),o=(t,{id:e,amount:r})=>t.$axios.$post(`cartoon_role/${e}/buy_stock`,{amount:r}),l=(t,{bangumi_id:e,name:r,intro:n,avatar:o,alias:l})=>t.$axios.$post("cartoon_role/manager/create",{bangumi_id:e,name:r,intro:n,avatar:o,alias:l}),c=(t,form)=>t.$axios.$post("cartoon_role/manager/edit",form),d=(t,form)=>t.$axios.$post("cartoon_role/manager/user_create",form),m=(t,{id:e})=>t.$axios.$get(`cartoon_role/${e}/get_idol_deal`),_=(t,form)=>t.$axios.$post("cartoon_role/create_deal",form),h=(t,form)=>t.$axios.$post("cartoon_role/make_deal",form),f=(t,{id:e})=>t.$axios.$post("cartoon_role/delete_deal",{id:e}),v=t=>t.$axios.$get("cartoon_role/stock_meta"),y=(t,form)=>t.$axios.$post("cartoon_role/create_market_price_draft",form),x=(t,{is_agree:e,idol_id:r,draft_id:n})=>t.$axios.$post("cartoon_role/vote_market_price_draft",{is_agree:e,idol_id:r,draft_id:n}),$=(t,{idol_id:e,qq_group:r,lover_words:n,manager_id:o})=>t.$axios.$post("cartoon_role/change_idol_profile",{idol_id:e,qq_group:r,lover_words:n,manager_id:o}),w=t=>t.$axios.$get("cartoon_role/user_draft_work"),k=t=>t.$axios.$get("cartoon_role/can_use_income"),C=(t,{product_id:e,product_type:r,amount:n})=>t.$axios.$post("cartoon_role/create_buy_request",{product_id:e,product_type:r,amount:n}),I=(t,{order_id:e,result:r})=>t.$axios.$post("cartoon_role/check_product_request",{order_id:e,result:r}),S=(t,{order_id:e})=>t.$axios.$post("cartoon_role/delete_buy_request",{order_id:e}),N=(t,{order_id:e})=>t.$axios.$post("cartoon_role/over_buy_request",{order_id:e}),E=t=>t.$axios.$get("cartoon_role/get_mine_product_orders"),j=(t,{idol_id:e,days:r})=>t.$axios.$get("cartoon_role/get_idol_days_chart",{params:{idol_id:e,days:r}})},240:function(t,e){},241:function(t,e,r){"use strict";var n={name:"CommentReplyForm",props:{type:{required:!0,type:String},id:{required:!0,type:Number},toUserId:{required:!0,type:Number},value:{type:Boolean,default:!1,required:!0}},data(){return{open:this.value,submitting:!1,content:""}},mounted(){this.$watch("value",t=>{this.open=t,t&&this.$nextTick(()=>{this.$refs.input.focus()})}),this.$watch("open",t=>{this.$emit("input",t)})},methods:{cancel(){this.open=!1},async submit(){if(this.$store.state.login){if(this.content&&!this.submitting){this.submitting=!0;try{const t=await this.$store.dispatch("comment/createSubComment",{id:this.id,ctx:this,type:this.type,content:this.content,targetUserId:this.toUserId});this.open=!1,this.content="",this.$toast.success(t.message),this.$store.commit("UPDATE_USER_EXP",t.exp)}catch(t){}finally{this.submitting=!1}}}else this.$channel.$emit("sign-in")}}},o=r(0);var component=Object(o.a)(n,function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.open?r("div",{staticClass:"comment-reply-form"},[t._ssrNode('<div class="btn-group">',"</div>",[r("el-button",{attrs:{size:"mini",type:"info",plain:""},on:{click:t.cancel}},[t._v("\n      取消\n    ")]),t._ssrNode(" "),r("el-button",{attrs:{loading:t.submitting,size:"mini",type:"primary"},on:{click:t.submit}},[t._v("\n      发表\n    ")])],2),t._ssrNode(' <div class="input-wrap"><input type="text" placeholder="请缩减至100字以内" maxlength="100"'+t._ssrAttr("value",t.content)+"></div>")],2):t._e()},[],!1,function(t){var e=r(249);e.__inject__&&e.__inject__(t)},null,"f8f6afc8");e.a=component.exports},242:function(t,e){},247:function(t,e,r){"use strict";var n=r(241),o={name:"VSubCommentItem",components:{CommentReplyForm:n.a},props:{comment:{required:!0,type:Object},parentUserId:{required:!0,type:Number},type:{required:!0,type:String,default:""}},data:()=>({showReplyArea:!1,deleting:!1}),computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},isMine(){return this.currentUserId===this.comment.from_user_id},canDelete(){return this.isMine||this.currentUserId===this.parentUserId},focusThisComment(){return parseInt(this.$route.query["reply-id"])===this.comment.id}},methods:{openReplyForm(){this.currentUserId?this.showReplyArea=!this.showReplyArea:this.$channel.$emit("sign-in")},deleteComment(){this.deleting||(this.deleting=!0,this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.dispatch("comment/deleteSubComment",{ctx:this,type:this.type,id:this.comment.id,parentId:this.comment.parent_id})}).catch(t=>{this.deleting=!1,"cancel"!==t&&this.$toast.error(t)}))}}},l=r(0);var c={name:"VSubCommentList",components:{SubCommentItem:Object(l.a)(o,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"sub-comment-item",class:{"focused-sub-comment":t.focusThisComment},attrs:{id:"sub-comment-"+t.comment.id}},[t._ssrNode('<div class="sub-user">',"</div>",[t._ssrNode('<div class="avatar">',"</div>",[r("user-card",{attrs:{id:t.comment.from_user_id,zone:t.comment.from_user_zone}},[r("v-img",{attrs:{src:t.comment.from_user_avatar,avatar:!0,width:24,height:24}})],1)],1)]),t._ssrNode(" "),t._ssrNode('<div class="sub-body">',"</div>",[r("user-card",{attrs:{id:t.comment.from_user_id,zone:t.comment.from_user_zone,"custom-class":"from-user href-fade-blue"}},[t._v("\n      "+t._s(t.comment.from_user_name)+"\n    ")]),t._ssrNode(" "),t._ssrNode('<span class="sub-text">',"</span>",[t.comment.to_user_id&&t.comment.to_user_id!==t.parentUserId?[t._ssrNode("\n        回复\n        "),r("user-card",{attrs:{id:t.comment.to_user_id,zone:t.comment.to_user_zone,"custom-class":"to-user"}},[t._v("\n          @"+t._s(t.comment.to_user_name)+"\n        ")])]:t._e(),t._ssrNode(t._ssrEscape("\n      "+t._s(t.comment.content)+"\n    "))],2),t._ssrNode(" "),t._ssrNode('<div class="sub-extra">',"</div>",[r("el-tooltip",{attrs:{content:t.comment.created_at,placement:"top",effect:"dark"}},[r("v-time",{model:{value:t.comment.created_at,callback:function(e){t.$set(t.comment,"created_at",e)},expression:"comment.created_at"}})],1),t._ssrNode(' <button class="reply-btn">\n        回复\n      </button> '),t.canDelete?t._ssrNode("<button>","</button>",[t._ssrNode('<i class="iconfont icon-shanchu"></i>')],2):r("report-dialog",{attrs:{id:t.comment.id,type:t.type+"_reply"}},[r("button",{staticClass:"reply-btn"},[t._v("\n          举报\n        ")])])],2),t._ssrNode(" "),r("comment-reply-form",{attrs:{id:t.comment.parent_id,type:t.type,"to-user-id":t.comment.from_user_id},model:{value:t.showReplyArea,callback:function(e){t.showReplyArea=e},expression:"showReplyArea"}})],2)],2)},[],!1,function(t){var e=r(250);e.__inject__&&e.__inject__(t)},null,"984d8742").exports},props:{parentComment:{required:!0,type:Object},type:{required:!0,type:String,default:""}},data:()=>({loading:!1,showCollapse:!1,collapsed:!1}),computed:{comments(){return this.parentComment.comments},authorId(){return this.parentComment.from_user_id},filterComments(){if(!this.collapsed)return this.comments.list;const data=this.comments,t=data.list,e=t.slice(0,5);if(t.every(t=>t.id<=data.maxId))return e;const r=e.map(t=>t.id);return e.concat(t.filter(t=>t.id>data.maxId&&-1===r.indexOf(t.id)))}},methods:{async loadMore(){if(!this.loading){this.loading=!0;try{await this.$store.dispatch("comment/getSubComments",{ctx:this,type:this.type,id:this.parentComment.id}),this.showCollapse=!0}catch(t){}finally{this.loading=!1}}}}};var d={name:"VCommentItem",components:{SubCommentList:Object(l.a)(c,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"sub-comment-list-wrap"},[t._l(t.filterComments,function(e){return r("sub-comment-item",{key:e.id,attrs:{comment:e,"parent-user-id":t.authorId,type:t.type}})}),t._ssrNode(" "+(!t.comments.noMore||t.comments.list.length>5?'<div class="view-more">\n    共<strong>'+t._ssrEscape(t._s(t.comments.total))+"</strong>条回复\n    "+(t.comments.noMore?"\x3c!----\x3e":'\n      ，\n      <button class="more-btn">\n        查看更多\n      </button>')+" "+(t.showCollapse?'<button class="collapse-btn">'+t._ssrEscape("\n      "+t._s(t.collapsed?"展开":"收起")+"\n    ")+"</button>":"\x3c!----\x3e")+"</div>":"\x3c!----\x3e"))],2)},[],!1,function(t){var e=r(251);e.__inject__&&e.__inject__(t)},null,"8442972c").exports,CommentReplyForm:n.a},props:{comment:{required:!0,type:Object},masterId:{required:!0,type:[Number,String]},type:{required:!0,type:String,default:""}},data:()=>({deleting:!1,liking:!1,showReplyArea:!1}),computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},authorId(){return this.comment.from_user_id},isMine(){return this.currentUserId===this.authorId},canDelete(){return this.isMine||this.currentUserId===this.masterId},focusThisComment(){return parseInt(this.$route.query["comment-id"])===this.comment.id}},methods:{async toggleLike(){if(this.currentUserId){if(!this.liking){this.liking=!0;try{await this.$store.dispatch("comment/toggleLikeMainComment",{ctx:this,type:this.type,id:this.comment.id})}catch(t){}finally{this.liking=!1}}}else this.$channel.$emit("sign-in")},deleteComment(){this.deleting||(this.deleting=!0,this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.dispatch("comment/deleteMainComment",{ctx:this,type:this.type,id:this.comment.id}),this.$emit("delete")}).catch(t=>{this.deleting=!1,"cancel"!==t&&this.$toast.error(t)}))},replyComment(){this.currentUserId?this.showReplyArea=!this.showReplyArea:this.$channel.$emit("sign-in")}}};var m=Object(l.a)(d,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"def-comment-item",class:{"focused-main-comment":t.focusThisComment},attrs:{id:"comment-"+t.comment.id}},[t._ssrNode('<div class="user">',"</div>",[r("user-card",{attrs:{id:t.comment.from_user_id,zone:t.comment.from_user_zone}},[r("v-img",{staticClass:"avatar",attrs:{src:t.comment.from_user_avatar,avatar:!0,width:48,height:48}})],1)],1),t._ssrNode(" "),t._ssrNode('<div class="body">',"</div>",[t._ssrNode('<div class="header">',"</div>",[t._ssrNode("<a"+t._ssrAttr("href",t.$alias.user(t.comment.from_user_zone))+' target="_blank" class="blue-link">'+t._ssrEscape(t._s(t.comment.from_user_name))+"</a> "+(t.comment.is_owner?"<span>(楼主)</span>":"\x3c!----\x3e")+" "),t.comment.is_leader?r("el-tooltip",{attrs:{placement:"top",effect:"dark",content:"版主"}},[r("i",{staticClass:"iconfont icon-leader"})]):t.comment.is_master?r("el-tooltip",{attrs:{placement:"top",effect:"dark",content:"代行者"}},[r("i",{staticClass:"iconfont icon-master"})]):t._e()],2),t._ssrNode(' <div class="content">'+t._s(t.comment.content)+"</div> "),t._ssrNode('<div class="footer">',"</div>",[t._ssrNode('<span class="floor-count">'+t._ssrEscape("#"+t._s(t.comment.floor_count-1))+"</span> "),r("el-tooltip",{attrs:{content:t.comment.created_at,placement:"top",effect:"dark"}},[r("v-time",{attrs:{datetime:t.comment.created_at}})],1),t._ssrNode(' <button class="like-btn"><i'+t._ssrClass("iconfont",[t.comment.liked?"icon-dianzan-active":"icon-dianzan"])+"></i> "+(t.comment.like_count?"<span>"+t._ssrEscape(t._s(t.comment.like_count))+"</span>":"\x3c!----\x3e")+'</button> <button class="reply-btn">\n        回复\n      </button> '),t.canDelete?t._ssrNode('<button class="delete-btn">',"</button>",[t._ssrNode('<i class="iconfont icon-shanchu"></i>')],2):r("report-dialog",{attrs:{id:t.comment.id,type:t.type+"_comment"}},[r("button",{staticClass:"reply-btn main-comment-report-btn"},[t._v("\n          举报\n        ")])])],2),t._ssrNode(" "),r("comment-reply-form",{attrs:{id:t.comment.id,"to-user-id":t.authorId,type:t.type},model:{value:t.showReplyArea,callback:function(e){t.showReplyArea=e},expression:"showReplyArea"}}),t._ssrNode(" "),r("sub-comment-list",{attrs:{"parent-comment":t.comment,type:t.type}})],2)],2)},[],!1,function(t){var e=r(252);e.__inject__&&e.__inject__(t)},null,"8deb9696").exports,_={name:"CreateCommentForm",props:{type:{type:String,required:!0},id:{type:[Number,String],required:!0},masterId:{type:Number,required:!0}},data:()=>({content:""}),computed:{isGuest(){return!this.$store.state.login},submitting(){return this.$store.state.comment.submitting},userAvatar(){return this.isGuest?"https://image.calibur.tv/default/user-avatar":this.$store.state.user.avatar}},methods:{async submit(){if(this.isGuest)return this.$toast.info("继续操作前请先登录"),void this.$channel.$emit("sign-in");if(this.content&&!this.submitting){this.$store.commit("comment/SET_SUBMITTING",{result:!0});try{const t=await this.$store.dispatch("comment/createMainComment",{content:this.content,images:[],type:this.type,id:this.id,ctx:this});this.content="",this.withImage&&this.$refs.uploader.clearFiles(),this.$toast.success(t.message),this.$store.commit("UPDATE_USER_EXP",t.exp),window.__closeImageLazy__||setTimeout(()=>{const e=document.getElementById(`comment-${t.data.id}`);e&&this.$scrollToY(this.$utils.getOffsetTop(e)-200,600)},400),this.$emit("submit")}catch(t){}finally{this.$store.commit("comment/SET_SUBMITTING",{result:!1})}}},handleTextAreaFocus(){this.isGuest&&this.$channel.$emit("sign-in")}}};var h={name:"CommentMain",components:{CommentCreateForm:Object(l.a)(_,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"create-comment-form"},[e("v-img",{staticClass:"avatar",attrs:{src:this.userAvatar,width:48,height:48,avatar:!0}}),this._ssrNode(' <div class="main-area"><button class="submit-btn">\n      发表<br>评论\n    </button> <div class="text-wrap"><textarea placeholder="请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。" maxlength="1000"></textarea></div></div>')],2)},[],!1,function(t){var e=r(253);e.__inject__&&e.__inject__(t)},null,"0c39bf82").exports,CommentItem:m},props:{id:{required:!0,type:[Number,String]},type:{required:!0,type:String,validator:t=>~["post","video","image","score","question","answer","role"].indexOf(t)},onlySeeMaster:{type:Boolean,default:!1},masterId:{type:[Number,String],required:!0},emptyText:{type:String,default:"暂无评论，快来抢沙发吧╮(￣▽￣)╭！"},auto:{type:Boolean,default:!1},lazy:{type:Boolean,default:!1},showHeader:{type:Boolean,default:!0}},data:()=>({loading:!1}),computed:{store(){return this.$store.state.comment},list(){return this.store.list},noMore(){return this.store.noMore},total(){return this.store.total}},mounted(){this.auto&&this.$channel.$on(`fire-load-comment-${this.type}-${this.id}`,()=>{this.loadMore(!0)}),this.lazyLoadComment()},methods:{async loadMore(t=!1){if(!this.loading){this.loading=!0;try{await this.$store.dispatch("comment/getMainComments",{ctx:this,type:this.type,id:this.id,onlySeeMaster:this.onlySeeMaster?1:0,firstRequest:t})}catch(t){}finally{this.loading=!1}}},async lazyLoadComment(){if(!this.lazy)return void this.$nextTick(()=>{this.scrollToReply()});const{query:t}=this.$route;await this.$store.dispatch("comment/getMainComments",{id:this.id,type:this.type,seeReplyId:t["comment-id"],onlySeeMaster:t.only&&parseInt(t.only,10)?1:0}),this.$nextTick(()=>{this.scrollToReply()})},scrollToReply(){const t=this.$route.query["comment-id"];if(!t)return;const e=document.getElementById(`comment-${t}`);e&&this.$nextTick(()=>{this.$scrollToY(this.$utils.getOffsetTop(e)-200,400)})}}};var f=Object(l.a)(h,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"comment-wrap"}},[t._t("header",[t.showHeader?r("h3",{staticClass:"sub-title"},[t._v("\n      评论"+t._s(t.total?"("+t.total+")":"")+"\n    ")]):t._e(),t._v(" "),r("comment-create-form",{attrs:{id:t.id,type:t.type,"master-id":t.masterId},on:{submit:function(e){return t.$emit("create-main-comment")}}})]),t._ssrNode(" "),t.list.length?t._ssrNode('<div id="comment-list-wrap">',"</div>",t._l(t.list,function(e){return t._ssrNode('<div class="comment-item-wrap">',"</div>",[t._t("comment-item",[r("comment-item",{attrs:{comment:e,type:t.type,"master-id":t.masterId},on:{delete:function(e){return t.$emit("delete-main-comment")}}})],{comment:e})],2)}),0):t.emptyText?t._ssrNode('<p class="no-content">'+t._ssrEscape(t._s(t.emptyText))+"</p>"):t._e(),t._ssrNode(" "),t._ssrNode('<div id="comment-list-footer">',"</div>",[t._ssrNode('<div class="load-more-btn">',"</div>",[t.noMore?t._e():r("el-button",{attrs:{loading:t.loading,type:"info",plain:"",round:""},on:{click:function(e){return t.loadMore(!1)}}},[t._v("\n        "+t._s(t.loading?"加载中...":"加载更多")+"\n      ")])],1),t._ssrNode(" "),t._t("reply",[t.list.length>=10?r("comment-create-form",{attrs:{id:t.id,type:t.type,"master-id":t.masterId},on:{submit:function(e){return t.$emit("create-main-comment")}}}):t._e()])],2)],2)},[],!1,function(t){var e=r(254);e.__inject__&&e.__inject__(t)},null,"7259fc5b");e.a=f.exports},248:function(t,e,r){"use strict";r.r(e);var n=r(232),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},249:function(t,e,r){"use strict";r.r(e);var n=r(233),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},250:function(t,e,r){"use strict";r.r(e);var n=r(234),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},251:function(t,e,r){"use strict";r.r(e);var n=r(235),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},252:function(t,e,r){"use strict";r.r(e);var n=r(236),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},253:function(t,e,r){"use strict";r.r(e);var n=r(237),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},254:function(t,e,r){"use strict";r.r(e);var n=r(238),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},255:function(t,e,r){"use strict";var n={name:"ImagePreview",props:{images:{type:Array,default:()=>[]},query:{type:String,default:""},download:{type:Boolean,default:!0}},data(){return{show:!1,currentIndex:-1,maxWidth:0,maxHeight:0,displayImages:this.images.map(t=>Object.assign({finalWidth:0,finalHeight:0,loading:!0},t))}},computed:{total(){return this.images.length},currentImage(){return-1===this.currentIndex?null:this.displayImages[this.currentIndex]}},mounted(){this.getScreenSize(),window.addEventListener("resize",this.getScreenSize)},methods:{handleClose(){this.show=!1},handleClick(t){if(!this.total)return;const e=t.target||t.currentTarget,r="img"===e.tagName.toLowerCase();if(!this.query&&!r)return;if(this.query&&-1===e.className.indexOf(this.query))return;let n="";if(r)n=e.getAttribute("src").split("?")[0];else{const img=e.querySelector("img");if(!img)return;n=img.getAttribute("src").split("?")[0]}this.getClickImageIndex(n),this.computeDisplaySize(this.currentIndex),this.show=!0},getClickImageIndex(t){this.images.forEach((image,e)=>{image.url===t&&(this.currentIndex=e)})},getScreenSize(){this.maxWidth=window.innerWidth,this.maxHeight=window.innerHeight-88},switchImage(t){if(t&&this.currentIndex===this.total-1)return;if(!t&&0===this.currentIndex)return;const e=t?this.currentIndex+1:this.currentIndex-1;this.computeDisplaySize(e),this.currentIndex=e},getSiblingsIndex(t){let e,r;return 0===this.currentIndex?(e=this.total-1,r=1):this.currentIndex===this.total-1?(e=this.total-2,r=0):(e=this.currentIndex-1,r=this.currentIndex+1),[e,t,r]},computeDisplaySize(t){if(void 0===this.images[t])return;const image=this.images[t];if(image.finalWidth&&image.finalHeight)return;const e=image.width,r=image.height,n=this.maxWidth,o=this.maxHeight;let l,c;if(n>=e&&o>=r)l=e,c=r;else if(n<e&&o<r){const t=e/o,d=r/o;t>=d?(l=n,c=parseInt(r/t,10)):(l=parseInt(e/d,10),c=o)}else if(r<o){l=n,c=parseInt(r/(e/o),10)}else{l=parseInt(e/(r/o),10),c=o}this.displayImages[t].finalWidth=l||n,this.displayImages[t].finalHeight=c||o},handleSwitch(t,e){this.currentIndex=e}}},o=r(0);var component=Object(o.a)(n,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{class:t.$style.imagePreview,on:{click:t.handleClick}},[t._ssrNode((t.show?"<div"+t._ssrClass(null,t.$style.container)+"><div"+t._ssrClass(null,[t.$style.bar,t.$style.topBar])+">"+(t.total?"<span"+t._ssrClass(null,t.$style.total)+">"+t._ssrEscape("\n        "+t._s(t.currentIndex+1)+"/"+t._s(t.total)+"\n      ")+"</span>":"\x3c!----\x3e")+" <span"+t._ssrClass(null,t.$style.close)+">\n        ×\n      </span></div> <div"+t._ssrClass(null,[t.$style.bar,t.$style.footBar])+">"+(t.currentImage&&t.download?"<a"+t._ssrAttr("href",t.currentImage.url)+' target="_blank"'+t._ssrClass(null,t.$style.download)+">\n        下载原图\n      </a>":"\x3c!----\x3e")+"</div> "+(t.currentImage?"<div"+t._ssrClass(null,t.$style.wrap)+"><div"+t._ssrClass(null,t.$style.item)+t._ssrStyle(null,{backgroundImage:"url("+t.$resize(t.currentImage.url,{webP:!t.download})+")",width:t.currentImage.finalWidth+"px",height:t.currentImage.finalHeight+"px"},null)+"></div> "+(t.total>1?"<button"+t._ssrClass(null,t.$style.prevBtn)+'><i class="el-icon-caret-left"></i></button> <button'+t._ssrClass(null,t.$style.nextBtn)+'><i class="el-icon-caret-right"></i></button>':"\x3c!----\x3e")+"</div>":"\x3c!----\x3e")+"</div>":"\x3c!----\x3e")+" "),t._t("default")],2)},[],!1,function(t){var e=r(248);e.__inject__&&e.__inject__(t),this.$style=e.locals||e},null,"9fce79ee");e.a=component.exports},256:function(t,e,r){"use strict";r.r(e);var n=r(240),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},266:function(t,e,r){"use strict";var n={name:"PostShowItem",components:{ImagePreview:r(255).a},props:{item:{type:Object,required:!0},bangumiId:{type:[Number,String],default:""},userZone:{type:String,default:""}}},o=r(0);var component=Object(o.a)(n,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("li",{staticClass:"post-flow-item"},[t._ssrNode('<div class="header clearfix">',"</div>",[t.userZone?r("el-tooltip",{attrs:{content:t.item.bangumi.name,effect:"dark",placement:"top"}},[r("a",{staticClass:"bangumi-avatar",attrs:{href:t.$alias.bangumi(t.item.bangumi.id),target:"_blank"}},[r("v-img",{attrs:{src:t.item.bangumi.avatar,poster:!0,width:24,height:24}})],1)]):r("user-card",{attrs:{id:t.item.user.id,zone:t.item.user.zone,"custom-class":"user-avatar"}},[r("v-img",{attrs:{src:t.item.user.avatar,avatar:!0,width:32,height:32}})],1),t._ssrNode(" "),t._ssrNode('<span class="time">',"</span>",[t._ssrNode(" 发表于: "),r("v-time",{attrs:{datetime:t.item.created_at}})],2),t._ssrNode(" "+(t.item.top_at&&t.bangumiId?'<div class="top_badge">\n      置顶\n    </div>':"\x3c!----\x3e")+" "+(t.item.is_nice?'<div class="nice_badge">\n      精\n    </div>':"\x3c!----\x3e")+" "+(t.item.is_creator?'<div class="creator_badge">\n      原创\n    </div>':"\x3c!----\x3e")+' <div class="title oneline"><a'+t._ssrAttr("href",t.$alias.post(t.item.id))+' target="_blank" class="blue-link">'+t._ssrEscape(t._s(t.item.title))+"</a></div>")],2),t._ssrNode(" "+(t.item.user?"<p"+t._ssrClass("content",{"min-height":!t.item.images.length})+"><a"+t._ssrAttr("href",t.$alias.user(t.item.user.zone))+' target="_blank" class="nickname">'+t._ssrEscape(t._s(t.item.user.nickname))+"</a>\n    :\n    <a"+t._ssrAttr("href",t.$alias.post(t.item.id))+' target="_blank" class="desc">'+t._ssrEscape("\n      "+t._s(t.item.desc)+"\n    ")+"</a></p>":"<p"+t._ssrClass("content",{"min-height":!t.item.images.length})+">"+t._ssrEscape(t._s(t.item.desc))+"</p>")+" "),t.item.images.length?t._ssrNode('<div class="images clearfix">',"</div>",[r("image-preview",{attrs:{images:t.item.images,download:!1,query:"image-box"}},t._l(t.item.images,function(image,t){return r("div",{key:t,staticClass:"image-box"},[r("v-img",{attrs:{src:image.url,blur:!0,width:"auto",height:"90"}})],1)}),0)],1):t._e(),t._ssrNode(' <span class="counter">'+t._ssrEscape(t._s(t.item.comment_count))+"</span> "),t._ssrNode('<div class="footer clearfix">',"</div>",[t._ssrNode('<div class="stats">',"</div>",[t._ssrNode((t.item.is_creator?'<span class="meta"><i class="iconfont icon-fantuan"></i> <span>'+t._ssrEscape(t._s(t.$utils.shortenNumber(t.item.reward_count)))+"</span></span>":'<span class="meta"><i class="iconfont icon-like"></i> <span>'+t._ssrEscape(t._s(t.$utils.shortenNumber(t.item.like_count)))+"</span></span>")+' <span class="meta"><i class="iconfont icon-mark"></i> <span>'+t._ssrEscape(t._s(t.$utils.shortenNumber(t.item.mark_count)))+'</span></span> <span class="meta"><i class="iconfont icon-talk"></i> <span>'+t._ssrEscape(t._s(t.$utils.shortenNumber(t.item.comment_count)))+"</span></span> "),r("v-share",{attrs:{url:t.$alias.post(t.item.id),title:t.item.title,desc:t.item.desc,"show-text":!1,type:"button"}})],2),t._ssrNode(' <div class="tags oneline">'+(t.bangumiId?"\x3c!----\x3e":(t.item.bangumi?"<a"+t._ssrAttr("href",t.$alias.bangumi(t.item.bangumi.id))+' target="_blank"><i class="iconfont icon-biaoqian"></i> <span>'+t._ssrEscape(t._s(t.item.bangumi.name))+"</span></a>":"\x3c!----\x3e")+" "+(t.item.idol?"<a"+t._ssrAttr("href",t.$alias.cartoonRole(t.item.idol.id))+' target="_blank"><i class="iconfont icon-biaoqian"></i> <span>'+t._ssrEscape(t._s(t.item.idol.name))+"</span></a>":"\x3c!----\x3e"))+" "+t._ssrList(t.item.tags,function(e){return'<span class="tag">'+t._ssrEscape(t._s(e.name))+"</span>"})+"</div>")],2)],2)},[],!1,function(t){var e=r(256);e.__inject__&&e.__inject__(t)},null,"b52bb90c");e.a=component.exports},267:function(t,e,r){"use strict";r.r(e);var n=r(242),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},270:function(t,e,r){"use strict";var n={name:"TabContainer",props:{list:{type:Array,required:!0},def:{type:String,default:"0"},pos:{type:String,default:"top"},route:{type:Boolean,default:!0},title:{type:String,default:""}},data(){return{current:this.def}},mounted(){this.route&&(this.current=this.$route.name,this.$watch("$route",t=>{this.current=t.name}))},methods:{tabClick(i){this.route?this.go(i.name):this.$emit("change",this.title?i.index-1:i.index-0)},go(t){const e=t||"homepage";this.$router.push({name:e,params:this.$route.params})}}},o=r(0);var component=Object(o.a)(n,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-tabs",{staticClass:"tab-container",attrs:{"tab-position":t.pos},on:{"tab-click":t.tabClick},model:{value:t.current,callback:function(e){t.current=e},expression:"current"}},[t.title?r("el-tab-pane",{attrs:{label:t.title,disabled:!0,name:t.title}}):t._e(),t._v(" "),t._l(t.list,function(i,e){return r("el-tab-pane",{key:e,attrs:{label:i.label,name:t.route?i.name:""+e}},[t.route?t._e():t._t(""+e)],2)})],2)},[],!1,function(t){var e=r(267);e.__inject__&&e.__inject__(t)},null,"62d4b4c2");e.a=component.exports},276:function(t,e){},296:function(t,e){},297:function(t,e){},298:function(t,e){},354:function(t,e,r){"use strict";r.r(e);var n=r(276),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},374:function(t,e){},375:function(t,e){t.exports={wrap:"wrap-34","cartoon-role-btn":"cartoon-role-btn-3r",cartoonRoleBtn:"cartoon-role-btn-3r",locked:"locked-X-"}},376:function(t,e){},377:function(t,e){},378:function(t,e){},379:function(t,e){},380:function(t,e){},395:function(t,e,r){"use strict";var n=r(6),o=r(239),l={name:"CreateRoleForm",mixins:[n.a],props:{isCreate:{type:Boolean,default:!1},bangumiId:{type:[Number,String],default:0},role:{type:Object,default:null}},data(){return{form:{bangumi_id:this.bangumiId,name:this.role?this.role.name:"",alias:this.role?this.role.alias.split(","):[],avatar:this.role?this.role.avatar:"",intro:this.role?this.role.intro:"",stock_price:this.role?this.role.stock_price:"",max_stock_count:this.role?+this.role.max_stock_count||"未设置":""},rules:{name:[{validator:(t,e,r)=>e?e.length>35?r(new Error("名称最长 35 个字")):void r():r(new Error("请先填写角色名称")),trigger:"submit"}],intro:[{validator:(t,e,r)=>e?e.length>400?r(new Error("简介最多 400 个字")):void r():r(new Error("请先填写角色简介")),trigger:"submit"}],avatar:[{validator:(t,e,r)=>{if(!e)return r(new Error("请先上传头像"));r()},trigger:"submit"}],alias:[{validator:(t,e,r)=>e&&e.length?e.length>5?r(new Error("最多填写 5 个别名")):e.join("").length>200?r(new Error("最多 200 字")):void r():r(new Error("至少填写 1 个别名")),trigger:"submit"}]},submitting:!1}},methods:{submitEditProfile(){this.$refs.form.validate(async t=>{if(!t)return!1;{if(this.submitting)return;this.submitting=!0;const t=this.form.name;try{const e={bangumi_id:this.form.bangumi_id,name:t,intro:this.form.intro.trim(),avatar:this.form.avatar.split(".calibur.tv/").pop(),alias:[t].concat(this.form.alias.filter(e=>e!==t)).toString()};if("string"!=typeof e.alias&&(e.alias=e.alias.join(",")),this.isCreate){const t=await Object(o.g)(this,e);this.$refs.form.resetFields(),this.$refs.upload.clearFiles(),this.$toast.success("创建成功").then(()=>{window.open(this.$alias.cartoonRole(t))})}else await Object(o.j)(this,Object.assign(e,{id:this.role.id})),this.$emit("success")}catch(t){}finally{this.submitting=!1}}})},beforeAvatarUpload(t){return this.uploadConfig.max=1,this.uploadConfig.pathPrefix=`bangumi/${this.bangumiId}/role`,this.beforeImageUpload(t)},handleAvatarSuccess(t){this.$toast.success("上传成功"),this.form.avatar=t.data.url}}},c=r(0);var component=Object(c.a)(l,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"edit-idol-form"}},[r("el-alert",{staticStyle:{"margin-bottom":"15px"},attrs:{closable:!1,title:"目前只有版主可以编辑偶像",type:"warning"}}),t._ssrNode(" "),r("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,disabled:t.submitting,"label-width":"80px"}},[t.isCreate?r("el-form-item",{attrs:{label:"偶像名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"偶像的中文名"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name","string"==typeof e?e.trim():e)},expression:"form.name"}})],1):t._e(),t._v(" "),r("el-form-item",{attrs:{label:"偶像别名",prop:"alias"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"角色的其它名字，如：英文名、日文名"},model:{value:t.form.alias,callback:function(e){t.$set(t.form,"alias",e)},expression:"form.alias"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"偶像头像",prop:"avatar"}},[t.form.avatar?r("img",{staticClass:"avatar",staticStyle:{width:"100px",height:"100px"},attrs:{src:t.$resize(t.form.avatar,{width:200})}}):t._e(),t._v(" "),r("el-upload",{ref:"upload",attrs:{data:t.uploadHeaders,action:t.imageUploadAction,accept:t.imageUploadAccept,"on-error":t.handleImageUploadError,"before-upload":t.beforeAvatarUpload,"on-success":t.handleAvatarSuccess,"show-file-list":!1}},[r("el-button",{attrs:{size:"mini"}},[t._v("\n          点击上传\n        ")])],1)],1),t._v(" "),r("el-form-item",{attrs:{label:"偶像简介",prop:"intro"}},[r("el-input",{attrs:{rows:10,type:"textarea",placeholder:"请输入角色简介"},model:{value:t.form.intro,callback:function(e){t.$set(t.form,"intro",e)},expression:"form.intro"}})],1),t._v(" "),r("el-form-item",[r("el-button",{attrs:{loading:t.submitting,type:"primary"},on:{click:t.submitEditProfile}},[t._v("\n        确认提交\n      ")])],1)],1)],2)},[],!1,function(t){var e=r(354);e.__inject__&&e.__inject__(t)},null,"08c2cfec");e.a=component.exports},465:function(t,e,r){"use strict";r.r(e);var n=r(374),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},466:function(t,e,r){"use strict";r.r(e);var n=r(375),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},467:function(t,e){},468:function(t,e){},469:function(t,e,r){"use strict";r.r(e);var n=r(376),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},470:function(t,e,r){"use strict";r.r(e);var n=r(377),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},471:function(t,e,r){"use strict";r.r(e);var n=r(378),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},472:function(t,e,r){"use strict";r.r(e);var n=r(379),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},473:function(t,e,r){"use strict";r.r(e);var n=r(380),o=r.n(n);for(var l in n)"default"!==l&&function(t){r.d(e,t,function(){return n[t]})}(l);e.default=o.a},493:function(t,e,r){"use strict";r.r(e);r(297),r(2);var n=r(206),o=r.n(n),l=(r(298),r(207)),c=r.n(l),d=r(239),m=r(270),_=r(247),h=r(395),f={name:"IdolDealBtn",props:{id:{type:[Number,String],required:!0},price:{type:String,required:!0},name:{type:String,required:!0},locked:{type:Boolean,default:!1},count:{type:String,required:!0},state:{type:Number,required:!0}},data(){return{showDialog:!1,submitting:!1,deal:{id:0,idol_id:this.id,product_count:0,product_price:0},has_star:0,loaded:!1}},computed:{canGetMoney(){return parseFloat(this.deal.product_count*this.deal.product_price).toFixed(2)}},methods:{handleClick(){this.$store.state.login?"0.00"!==this.count?0!==this.state?(this.getCanExchangeCount(),this.showDialog=!0):this.$toast.error("上市之前不能出售"):this.$toast.error("需要先入股"):this.$channel.$emit("sign-in")},async getCanExchangeCount(){const{deal:t,has_star:e}=await Object(d.k)(this,{id:this.id});t&&(t.product_count=t.last_count,Object.keys(this.deal).forEach(e=>{this.deal[e]=t[e]})),this.has_star=e,this.loaded=!0},async submit(){if(this.canGetMoney<.01)this.$toast.error("最低收益不能小于 0.01");else if(!this.submitting){this.submitting=!0;try{await Object(d.d)(this,this.deal),this.$toast.success(this.deal.id?"交易修改成功，可到交易所查看":"交易创建成功，可到交易所查看"),this.showDialog=!1}catch(t){}finally{this.submitting=!1}}}}},v=r(0);var y=Object(v.a)(f,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",{staticClass:"idol-deal-btn-wrap"},[t._ssrNode("<button>出售</button> "),r("v-dialog",{attrs:{title:"出售「"+t.name+"」的股份",loading:t.submitting,width:"560px"},on:{submit:t.submit},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}},[r("el-alert",{attrs:{closable:!1,title:"交易建议",type:"info"}},[t.locked?r("p",[t._v("当前公开发售的股份已停牌，可高于市场价格出售")]):r("p",[t._v("当前仍有股份在公开发售，应该低于公开价格发售")]),t._v(" "),r("p",[t._v("\n        最终交易的总价值不得低于 0.01 个虚拟币，当前市场价："),r("strong",[t._v(t._s(t.price))]),t._v("/股\n      ")]),t._v(" "),t.loaded?r("p",[t._v("\n        "+t._s(t.deal.id?"检测到当前有正在出售的交易，可对其进行修改":"当前未有正在进行的交易，可新建一个交易")+"\n      ")]):t._e()]),t._v(" "),r("el-form",{attrs:{"label-position":"top"}},[r("el-form-item",{attrs:{label:"出售份额"}},[r("el-input-number",{attrs:{min:.01,step:.01,max:t.has_star},model:{value:t.deal.product_count,callback:function(e){t.$set(t.deal,"product_count",e)},expression:"deal.product_count"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"出售价格"}},[r("el-input-number",{attrs:{min:.01,max:10,step:.01},model:{value:t.deal.product_price,callback:function(e){t.$set(t.deal,"product_price",e)},expression:"deal.product_price"}})],1),t._v(" "),r("p",[t._v("预计收益："+t._s(t.canGetMoney)+"（精度为小数点后两位，超出的不计）")])],1)],1)],2)},[],!1,function(t){var e=r(465);e.__inject__&&e.__inject__(t)},null,"5cd073df").exports,x={name:"CartoonRoleBtn",props:{id:{type:[Number,String],required:!0},price:{type:String,required:!0},max:{type:Number,required:!0},buyed:{type:Number,required:!0},idol:{type:Object,required:!0}},data(){return{showDialog:!1,submitting:!1,count:this.idol.company_state?.01:1}},computed:{signed(){return this.$store.state.login},pocket(){return this.signed?+this.$store.state.user.pocket:0},maxCount(){const t=this.idol.max_stock_count&&"0.00"!==this.idol.max_stock_count?this.idol.max_stock_count-this.idol.star_count:-1,e=this.pocket?this.pocket/this.idol.stock_price:0;return-1===t?e:Math.min(e,t)},minCount(){return Math.min(this.idol.company_state?.01:1,this.maxCount)},needPay(){return this.count?parseFloat(this.idol.stock_price*this.count).toFixed(2):"0.00"}},methods:{handleStarRole(){this.idol.is_locked?this.$toast.error("已经停牌了，等待下次挂牌吧"):this.signed?this.pocket?this.showDialog=!0:this.$toast.error("团子不足"):this.$channel.$emit("sign-in")},async submit(){if(this.count<=0)this.$toast.error("未选择份额");else if(!this.submitting){this.submitting=!0;try{await Object(d.u)(this,{id:this.id,amount:this.count}),this.$store.commit("USE_COIN",this.needPay),this.$emit("success",{count:this.count,amount:this.needPay}),this.showDialog=!1}catch(t){}finally{this.submitting=!1}}}}};var $=Object(v.a)(x,function(){var t,e=this,r=e.$createElement,n=e._self._c||r;return n("span",{class:e.$style.wrap},[e._ssrNode("<button"+e._ssrClass(null,[e.$style.cartoonRoleBtn,(t={},t[e.$style.locked]=e.idol.is_locked,t)])+">"+e._ssrEscape("\n    "+e._s(e.idol.is_locked?"已停牌":"入股")+"\n  ")+"</button> "),n("v-dialog",{attrs:{title:"入股 - "+e.idol.name,loading:e.submitting,width:"560px"},on:{submit:e.submit},model:{value:e.showDialog,callback:function(t){e.showDialog=t},expression:"showDialog"}},[n("el-form",{attrs:{"label-position":"top"}},[n("el-form-item",{attrs:{label:"当前股价"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.price,callback:function(t){e.price=t},expression:"price"}},[n("template",{slot:"append"},[e._v("虚拟币每股")])],2)],1),e._v(" "),n("el-form-item",{attrs:{label:"购入上限"}},[n("el-input",{attrs:{disabled:!0,placeholder:parseFloat(e.maxCount).toFixed(2)+"股"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"购入份额"}},[e.signed?n("el-input-number",{attrs:{min:e.minCount,step:.01,max:e.maxCount},model:{value:e.count,callback:function(t){e.count=t},expression:"count"}}):e._e()],1),e._v(" "),n("el-form-item",{attrs:{label:"账单计算"}},[n("div",{staticClass:"pocket"},[n("strong",[e._v("预计支付：")]),n("span",[e._v(e._s(e.needPay))]),e._v("   "),n("strong",[e._v("购买后钱包余额：")]),n("span",[e._v(e._s(parseFloat(e.pocket-e.needPay).toFixed(2)))])])])],1)],1)],2)},[],!1,function(t){var e=r(466);e.__inject__&&e.__inject__(t),this.$style=e.locals||e},null,"302ad839").exports,w=r(55),k={name:"IdolOwnerList",components:{FlowList:w.a},props:{id:{type:[Number,String],required:!0},name:{type:String,required:!0},star:{type:[Number,String],required:!0}},data:()=>({active:"按持股由多到少"}),methods:{handleTabSwitch(label){"按持股由多到少"===label?this.getBigOwner():this.getNewOwner()},computedPercent(t){return`${parseFloat(t/this.star*100).toFixed(2)}%`},getBigOwner(){this.$store.dispatch("flow/initData",{func:"virtualIdolOwners",type:"seenIds",sort:"biggest",id:this.id})},getNewOwner(){this.$store.dispatch("flow/initData",{func:"virtualIdolOwners",type:"lastId",sort:"newest",id:this.id})}}},C=Object(v.a)(k,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"idol-owner-list"}},[t._ssrNode("<div>","</div>",[r("el-radio-group",{attrs:{size:"mini"},on:{change:t.handleTabSwitch},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[r("el-radio-button",{attrs:{label:"按持股由多到少"}}),t._v(" "),r("el-radio-button",{attrs:{label:"按最新入股排序"}})],1)],1),t._ssrNode(" "),r("flow-list",{directives:[{name:"show",rawName:"v-show",value:"按持股由多到少"===t.active,expression:"active === '按持股由多到少'"}],attrs:{id:t.id,func:"virtualIdolOwners",type:"seenIds",sort:"biggest"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.flow;return r("ul",{staticClass:"likes-modal"},t._l(n,function(e){return r("li",{key:e.id},[r("a",{staticClass:"user",attrs:{href:t.$alias.user(e.zone),target:"_blank"}},[r("img",{staticClass:"avatar",attrs:{src:t.$resize(e.avatar,{width:80})}}),t._v(" "),r("span",{staticClass:"nickname",domProps:{textContent:t._s(e.nickname)}}),t._v(" "),r("span",{staticClass:"score"},[t._v("持有"+t._s(e.score)+"股，占比"+t._s(t.computedPercent(e.score)))])])])}),0)}}])},[t._v(" "),r("template",{slot:"nothing"},[r("br"),t._v(" "),r("no-content",[r("el-button",{attrs:{round:""},on:{click:function(e){return t.$toast.warn("Orz")}}},[t._v("\n          可怜的「"+t._s(t.name)+"」还没有人入股\n        ")])],1)],1)],2),t._ssrNode(" "),r("flow-list",{directives:[{name:"show",rawName:"v-show",value:"按最新入股排序"===t.active,expression:"active === '按最新入股排序'"}],attrs:{id:t.id,func:"virtualIdolOwners",type:"lastId",sort:"newest"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.flow;return r("ul",{staticClass:"likes-modal"},t._l(n,function(e){return r("li",{key:e.id},[r("a",{staticClass:"user",attrs:{href:t.$alias.user(e.zone),target:"_blank"}},[r("img",{staticClass:"avatar",attrs:{src:t.$resize(e.avatar,{width:80})}}),t._v(" "),r("span",{staticClass:"nickname",domProps:{textContent:t._s(e.nickname)}}),t._v(" "),r("v-time",{staticClass:"score",model:{value:e.score,callback:function(r){t.$set(e,"score",r)},expression:"item.score"}})],1)])}),0)}}])},[t._v(" "),r("template",{slot:"nothing"},[r("br"),t._v(" "),r("no-content",[r("el-button",{attrs:{round:""},on:{click:function(e){return t.$toast.warn("Orz")}}},[t._v("\n          可怜的「"+t._s(t.name)+"」还没有人入股\n        ")])],1)],1)],2)],2)},[],!1,null,null,"14e5bd40").exports,I=(r(467),r(218)),S=r.n(I),N=(r(468),r(219)),E={name:"IdolMarketPriceDraft",components:{"el-steps":r.n(N).a,"el-step":S.a},props:{isBoss:{type:Boolean,required:!0},idol:{type:Object,required:!0}},data:()=>({submitting:!1}),computed:{source(){return this.$store.getters["flow/getFlow"]("getIdolDraftList","new",this.idol.id)},draft(){return this.source&&this.source.total?this.source.list[0]:null}},methods:{async submitVote(t){if(!this.submitting){this.submitting=!0;try{await Object(d.s)(this,{is_agree:t,idol_id:this.idol.id,draft_id:this.draft.id}),this.$toast.success("投票成功"),setTimeout(()=>{window.location.reload()},1e3)}catch(t){this.submitting=!1}}}}};var j=Object(v.a)(E,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"idol-market-price-draft"}},[t.draft&&0==t.draft.result?t._ssrNode("<div>","</div>",[r("el-alert",{attrs:{"show-icon":"",type:"warning",title:"提案项在通过或反对占比大于「50%」之后，会由系统自动增发股票/或关闭提案（最多延迟5分钟）"}}),t._ssrNode(" <br> "),r("el-alert",{attrs:{"show-icon":"",type:"warning",title:"若股东超过两天仍未投票，则视为弃权，将会用已投票的数据通过或驳回增发提案"}}),t._ssrNode(" "),t._ssrNode('<div class="draft-control">',"</div>",[t._ssrNode('<div class="text-wrap"><p><strong>提案内容：</strong> <span>'+t._ssrEscape("预增发"+t._s(t.draft.add_stock_count)+"股，每股￥"+t._s(t.draft.stock_price))+"</span></p> <p><strong>提案董事：</strong> <span>"+t._ssrEscape(t._s(t.draft.user.nickname))+"</span></p> <p><strong>提案时间：</strong> <span>"+t._ssrEscape(t._s(t.draft.created_at))+"</span></p> <p><strong>通过情况：</strong> <span>"+t._ssrEscape(t._s(t.draft.pass_count)+"人投票，占比："+t._s(t.draft.pass_percent)+"%")+"</span></p> <p><strong>反对情况：</strong> <span>"+t._ssrEscape(t._s(t.draft.ban_count)+"人投票，占比："+t._s(t.draft.ban_percent)+"%")+"</span></p> <p><strong>我的选择：</strong> <span>"+t._ssrEscape(t._s(0===t.draft.voted?"未投票":t.draft.voted>0?"赞同票":"反对票"))+"</span></p></div> "),t._ssrNode('<div class="button-wrap">',"</div>",[r("el-button",{attrs:{loading:t.submitting,plain:t.draft.voted>0,type:"primary",icon:"el-icon-caret-top"},on:{click:function(e){return t.submitVote(!0)}}},[t._v("\n          同意\n        ")]),t._ssrNode(" "),r("el-button",{attrs:{loading:t.submitting,plain:t.draft.voted<0,type:"danger"},on:{click:function(e){return t.submitVote(!1)}}},[t._v("\n          反对\n          "),r("i",{staticClass:"el-icon-caret-bottom el-icon--right"})])],2)],2)],2):t._e(),t._ssrNode(" "),t.source&&t.source.noMore?r("el-steps",{attrs:{space:"100px",direction:"vertical"}},[t.idol.ipo_at?t.source.total?[t._l(t.source.list,function(t){return r("el-step",{key:t.id,attrs:{status:0===t.result?"finish":1===t.result?"success":"error",description:t.created_at+" - 本提案由「"+t.user.nickname+"」发起，发行「"+t.add_stock_count+"」股，每股「￥"+t.stock_price+"」，"+(0===t.result?"董事会正在投票":1===t.result?"董事会表决通过":"董事会表决未通过"),title:"增发提案"}})}),t._v(" "),r("el-step",{attrs:{description:t.idol.ipo_at,title:"公司上市",status:"success"}}),t._v(" "),r("el-step",{attrs:{description:t.idol.created_at,title:"公司注册",status:"success"}})]:[r("el-step",{attrs:{title:"增发提案",status:"process",description:"大股东还未发起提案"}}),t._v(" "),r("el-step",{attrs:{description:t.idol.ipo_at,title:"公司上市",status:"success"}}),t._v(" "),r("el-step",{attrs:{description:t.idol.created_at,title:"公司注册",status:"success"}})]:[r("el-step",{attrs:{title:"增发提案",status:"wait",description:"还未选举出大股东"}}),t._v(" "),r("el-step",{attrs:{description:"投资人未满20人，还差"+(20-t.idol.fans_count)+"人",title:"等待上市",status:"process"}}),t._v(" "),r("el-step",{attrs:{description:t.idol.created_at,title:"公司注册",status:"success"}})]],2):t._e()],2)},[],!1,function(t){var e=r(469);e.__inject__&&e.__inject__(t)},null,"7832aa96").exports,F={name:"CreatePriceMarketDraft",props:{role:{type:Object,default:null},minLevel:{type:Number,default:500}},data(){return{editStockForm:{star_count:this.role.star_count,stock_price:+this.role.stock_price,max_stock_count:+this.role.max_stock_count,market_price:+this.role.market_price,new_price:this.role.stock_price,add_stock_count:this.minLevel},submitting:!1}},computed:{minAddPrice(){if(!this.editStockForm)return 0;let t;return(t=this.editStockForm.star_count<4e3?.25*this.editStockForm.market_price:.1*this.editStockForm.market_price)<this.minLevel?parseFloat(this.minLevel).toFixed(2):parseFloat(t).toFixed(2)},curAddPrice(){return this.editStockForm.new_price?parseFloat(this.editStockForm.new_price*this.editStockForm.add_stock_count).toFixed(2):0},totalMarketPrice(){return this.role?parseFloat(+this.role.market_price+ +this.curAddPrice).toFixed(2):0},maxStockCount(){return this.role?+this.role.max_stock_count+this.editStockForm.add_stock_count:0}},methods:{async changeIdolStock(){if(this.curAddPrice){if(this.curAddPrice-this.minAddPrice<0)this.$toast.error("不能定价太低");else if(!this.submitting){this.submitting=!0;try{await Object(d.f)(this,{idol_id:this.role.id,add_stock_count:this.editStockForm.add_stock_count,stock_price:this.editStockForm.new_price}),this.$toast.success("修改成功"),setTimeout(()=>{window.location.reload()},1e3)}catch(t){this.submitting=!1}}}else this.$toast.error("请先定价")}}},O=Object(v.a)(F,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"create-price-market-draft"}},[r("el-alert",{staticStyle:{"margin-bottom":"15px"},attrs:{closable:!1,type:"info",title:"发行规则"}},[r("p",[t._v("每次增发的股份，不能小于 "+t._s(t.minLevel)+" 股")]),t._v(" "),r("p",[t._v("现阶段，不支持以每股价格低于 1.00 或高于 10.00 的价格进行增发")])]),t._ssrNode(" "),r("el-alert",{staticStyle:{"margin-bottom":"15px"},attrs:{closable:!1,type:"info",title:"当前数据"}},[r("p",[t._v("当前每股的价格："+t._s(t.editStockForm.stock_price))]),t._v(" "),r("p",[t._v("当前总发行股份："+t._s(t.editStockForm.max_stock_count||"未设上限"))]),t._v(" "),r("p",[t._v("当前已售出股份："+t._s(t.editStockForm.star_count))])]),t._ssrNode(" "),r("el-form",{attrs:{"label-width":"80px"}},[r("el-form-item",{attrs:{label:"每股股价",prop:"stock_price"}},[r("el-input-number",{attrs:{min:1,max:10,step:.01},model:{value:t.editStockForm.new_price,callback:function(e){t.$set(t.editStockForm,"new_price",e)},expression:"editStockForm.new_price"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"增发数额",prop:"max_stock_count"}},[r("el-input-number",{attrs:{step:1,min:t.minLevel},model:{value:t.editStockForm.add_stock_count,callback:function(e){t.$set(t.editStockForm,"add_stock_count",e)},expression:"editStockForm.add_stock_count"}})],1),t._v(" "),r("el-form-item",[r("p",[t._v("\n        最低增发市值：￥"+t._s(t.minAddPrice)+" ，当前增发市值：￥"+t._s(t.curAddPrice)+" ，增发后总市值：￥"+t._s(t.totalMarketPrice)+"\n      ")])]),t._v(" "),r("el-form-item",[r("el-button",{attrs:{loading:t.submitting,type:"primary"},on:{click:t.changeIdolStock}},[t._v("\n        提交变更提案\n      ")])],1)],1)],2)},[],!1,null,null,"0c7143c1").exports,A={name:"ChangeIdolProfile",props:{idol:{type:Object,required:!0}},data(){return{qq_group:this.idol.qq_group,lover_words:this.idol.lover_words,manager_id:this.idol.manager?this.idol.manager.id:"",submitting:!1}},methods:{beforeSubmit(){if(this.submitting)return;const t=this.lover_words.trim();t?t.length>20?this.$toast.error("留言给我缩减至20字以内重说！"):t||this.qq_group?!this.qq_group||/^\d+$/.test(this.qq_group)?(this.manager_id&&!/^\d+$/.test(this.manager_id)&&this.$toast.error("经纪人的id是数字"),!this.qq_group||this.idol.qq_group?this.doSubmit():this.$confirm("QQ群号设置之后不能再修改，确认要设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.doSubmit()}).catch(()=>{})):this.$toast.error("QQ群号必须是数字"):this.$toast.error("内容不能为空"):this.$toast.error("需要填写留言")},async doSubmit(){this.submitting=!0;try{await Object(d.a)(this,{idol_id:this.idol.id,qq_group:this.qq_group,manager_id:this.manager_id,lover_words:this.lover_words.trim()}),this.$toast.success("修改成功"),setTimeout(()=>{window.location.reload()},1e3)}catch(t){this.submitting=!1}}}};var T=Object(v.a)(A,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"change-idol-profile"}},[t._ssrNode('<p class="tips">\n    修改特殊留言（一周只能修改一次，20字以内）：\n  </p> '),r("el-input",{attrs:{rows:3,type:"textarea",placeholder:"用简单的文字表达你的爱吧！"},model:{value:t.lover_words,callback:function(e){t.lover_words=e},expression:"lover_words"}}),t._ssrNode(' <p class="tips">\n    修改QQ群号<span class="warn">（设置之后不能修改）</span>：\n  </p> '),r("el-input",{attrs:{placeholder:"填写QQ群号码"},model:{value:t.qq_group,callback:function(e){t.qq_group=e},expression:"qq_group"}}),t._ssrNode(' <div class="tips">\n    修改经纪人\n  </div> '),r("el-input",{attrs:{placeholder:"填写要任命的经纪人的邀请码"},model:{value:t.manager_id,callback:function(e){t.manager_id=e},expression:"manager_id"}}),t._ssrNode(" "),r("el-button",{attrs:{loading:t.submitting,type:"primary"},on:{click:t.beforeSubmit}},[t._v("\n    确认提交\n  ")])],2)},[],!1,function(t){var e=r(470);e.__inject__&&e.__inject__(t)},null,"8fbac4b0").exports,z=r(220),P=r.n(z),B={name:"IdolStockChart",props:{idol:{type:Object,required:!0}},data(){return{chart:null,index:0,list:[this.idol.chart,[],[]]}},computed:{hasLimited(){return"0.00"!==this.idol.max_stock_count},hasBuyStock(){return"0.00"!==this.idol.has_star},computedPercent(){return this.idol.has_star?`${parseFloat(this.idol.has_star/this.idol.star_count*100).toFixed(2)}%`:""},productBalance(){const t=this.idol.total_pay-this.idol.total_income,e=`${parseFloat(t/this.idol.market_price*100).toFixed(2)}%`;return`￥${parseFloat(t).toFixed(2)}（${e}）`}},mounted(){this.initF2Animation(),this.drawChart(this.list[this.index]),this.getIdolChartData(7,1),this.getIdolChartData(30,2)},methods:{initF2Animation(){P.a.Animate.registerAnimation("lineUpdate",function(t,e){const r=t.get("cacheShape"),n=r.attrs,o=r.geomType,l=n.points,c=t.attr("points"),d=l.length,m=c.length;let _="area"===o?(d-m)/2:d-m;if(_>0){const t=c[0],e=c[c.length-1];for(let i=0;i<_;i++)c.splice(0,0,t);if("area"===o)for(let t=0;t<_;t++)c.push(e)}else{_=Math.abs(_);const t=l[0],e=l[l.length-1];for(let e=0;e<_;e++)l.splice(0,0,t);if("area"===o)for(let p=0;p<_;p++)l.push(e);n.points=l}t.attr(n),t.animate().to({attrs:{points:c},duration:800,easing:e.easing})})},getIdolChartData(t,e){Object(d.n)(this,{days:t,idol_id:this.idol.id}).then(data=>{this.list[e]=data}).catch(()=>{})},switchChart(t){this.index=t,this.chart.changeData(this.list[t])},drawChart(t){const data=t.map(t=>({time:1e3*+t.time,value:parseFloat(t.value).toFixed(2)}));if(!data.length)return;const e=new P.a.Chart({id:"chart-node",pixelRatio:window.devicePixelRatio});this.chart=e,e.source(data,{time:{type:"timeCat",tickCount:5,range:[0,1],mask:"HH:mm"},value:{type:"linear",alias:"市值",tickCount:5}}),e.tooltip({showCrosshairs:!0}),e.axis("time",{label:function(text,t,e){const r={textAlign:"center"};return 0===t&&(r.textAlign="start"),t>0&&t===e-1&&(r.textAlign="end"),r}}),e.line({sortable:!1}).position("time*value").shape("smooth").animate({update:{animation:"lineUpdate"}}),e.area({sortable:!1}).position("time*value").shape("smooth").animate({update:{animation:"lineUpdate"}}),e.render()}}};var M=Object(v.a)(B,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{attrs:{id:"idol-stock-chart"}},[t._ssrNode('<div class="chart-wrap"><canvas id="chart-node"></canvas> <div class="control"><button'+t._ssrClass(null,{active:0===t.index})+">\n        24 小时\n      </button> <button"+t._ssrClass(null,{active:1===t.index})+">\n        近 7 天\n      </button> <button"+t._ssrClass(null,{active:2===t.index})+'>\n        近 30 天\n      </button></div></div> <div class="table-wrap"><table class="table"><thead><tr><th>当前市值</th> <th>每股价格</th> <th>持股人数</th></tr></thead> <tbody><tr><td>'+t._ssrEscape("\n            "+t._s(t.idol.company_state?"￥"+t.idol.market_price:"未上市")+"\n          ")+"</td> <td>"+t._ssrEscape("￥"+t._s(t.idol.stock_price))+"</td> <td>"+t._ssrEscape(t._s(t.idol.fans_count)+"人")+"</td></tr></tbody> <thead><tr><th>总发行股</th> <th>已认购股</th> <th>我持有股</th></tr></thead> <tbody><tr><td>"+t._ssrEscape(t._s(t.hasLimited?t.idol.max_stock_count:"无上限"))+"</td> <td>"+t._ssrEscape(t._s(t.idol.star_count))+"</td> <td>"+t._ssrEscape("\n            "+t._s(t.hasBuyStock?t.idol.has_star+"（"+t.computedPercent+"）":"未入股")+"\n          ")+'</td></tr></tbody> <thead><tr><th>产品支出</th> <th>产品收入</th> <th>公司盈利</th></tr></thead> <tbody style="margin-bottom:5px"><tr><td>'+t._ssrEscape(t._s(t.idol.company_state?t.idol.total_pay:"-"))+"</td> <td>"+t._ssrEscape(t._s(t.idol.company_state?t.idol.total_income:"-"))+"</td> <td>"+t._ssrEscape(t._s(t.idol.company_state?t.productBalance:"-"))+"</td></tr></tbody></table></div>")])},[],!1,function(t){var e=r(471);e.__inject__&&e.__inject__(t)},null,"1d7ceea9").exports,D=(r(296),r(205)),R={name:"IdolOrderItem",components:{"el-tag":r.n(D).a},props:{item:{type:Object,required:!0}},data(){return{loading:!1,state:this.item.result}},computed:{canDelete(){return!!this.$store.state.login&&(0===this.state&&this.$store.state.user.zone===this.item.buyer.zone)},isMine(){return!!this.$store.state.login&&this.$store.state.user.zone===this.item.buyer.zone},computeTagColor(){const t=this.state;return 0===t?"":1===t?"success":2===t?"danger":3===t?"info":4===t?"warning":5===t?"info":6===t?"danger":""},computedResult(){const t=this.state;return 0===t?"等待作者确认":1===t?"已采购成功":2===t?"作者已拒绝":3===t?"订单已取消":4===t?"作品已出售":5===t?"作品已失效":6===t?"经纪人解约":"未知状态"}},methods:{cancelOrder(t){this.loading||this.$confirm("确认执行该操作吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{this.loading=!0,await Object(d.i)(this,{order_id:t}),this.$toast.success("订单已取消"),this.state=3}catch(t){}finally{this.loading=!1}}).catch()},rollbackOrder(t){this.loading||this.$confirm("终止后无法得到收益分成，也不会退还定金，确认要这么做吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{this.loading=!0,await Object(d.t)(this,{order_id:t}),this.$toast.success("订单已解约"),this.state=6}catch(t){this.$toast.error(t)}finally{this.loading=!1}}).catch()}}};var U=Object(v.a)(R,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("li",{staticClass:"idol-order-item"},[t._ssrNode("<a"+t._ssrAttr("href",t.$alias.user(t.item.buyer.zone))+' target="_blank"><img'+t._ssrAttr("src",t.$resize(t.item.buyer.avatar,{width:80}))+"> <span>"+t._ssrEscape(t._s(t.item.buyer.nickname))+"</span></a> <span>采购了</span> <a"+t._ssrAttr("href",t.$alias.user(t.item.author.zone))+' target="_blank"><span>'+t._ssrEscape(t._s(t.item.author.nickname))+"</span></a> <span>的帖子</span> <a"+t._ssrAttr("href",t.$alias.post(t.item.product.id))+' target="_blank">'+t._ssrEscape(t._s(t.item.product.title))+"</a> "),t._ssrNode("<div>","</div>",[t._ssrNode("<span>"+t._ssrEscape("价格：￥"+t._s(t.item.amount))+"</span> <span>"+t._ssrEscape("，分成："+t._s(t.item.income_ratio)+"%")+"</span> "),t._ssrNode("<span>","</span>",[t._ssrNode("，状态："),r("el-tag",{attrs:{size:"mini",type:t.computeTagColor}},[t._v(t._s(t.computedResult))])],2),t._ssrNode(" <span>"+t._ssrEscape("，时间："+t._s(t.item.created_at))+"</span> "),t.isMine?[0===t.state?r("el-button",{attrs:{loading:t.loading,size:"mini"},on:{click:function(e){return t.cancelOrder(t.item.id)}}},[t._v("\n        取消订单\n      ")]):t._e(),t._ssrNode(" "),1===t.state?r("el-button",{attrs:{loading:t.loading,size:"mini"},on:{click:function(e){return t.rollbackOrder(t.item.id)}}},[t._v("\n        终止订单\n      ")]):t._e()]:t._e()],2)],2)},[],!1,function(t){var e=r(472);e.__inject__&&e.__inject__(t)},null,"13790ed0").exports,L={name:"IdolProductOrderList",components:{FlowList:w.a,IdolOrderItem:U},props:{idolId:{type:String,required:!0}}},H=Object(v.a)(L,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"idol-product-order-list"},[r("el-alert",{attrs:{type:"info",title:"经纪人的采购记录将展示在这里"}},[t._v("\n    经纪人只能采购偶像所属番剧下的原创内容，目前只支持帖子，\n    每个内容仅能采购一次，重复采购会更新之前的采购数据，已出售的内容无法采购，\n    采购之后，需要作者同意后才会开始生效，作者同意之前，经纪人可取消订单\n  ")]),t._ssrNode(" "),r("flow-list",{attrs:{id:t.idolId,func:"getIdolProductOrders",type:"page",sort:"news"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.flow;return r("ul",{},t._l(n,function(t){return r("idol-order-item",{key:t.id,attrs:{item:t}})}),1)}}])})],2)},[],!1,null,null,"8c104044").exports,Q=r(266),G={name:"IdolProductArea",components:{FlowList:w.a,PostFlowItem:Q.a},props:{idolId:{type:String,required:!0},state:{type:Number,required:!0}}},W=Object(v.a)(G,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"idol-product-area"}},[r("flow-list",{attrs:{id:t.idolId,func:"getIdolProducts",type:"lastId",sort:"news"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.flow;return r("ul",{},t._l(n,function(t){return r("post-flow-item",{key:t.id,attrs:{item:t,"bangumi-id":"","user-zone":""}})}),1)}}])},[t._v(" "),r("no-content",{attrs:{slot:"nothing"},slot:"nothing"},[r("el-button",{attrs:{size:"mini"}},[t._v("\n        "+t._s(t.state?"暂无产品发售":"未上市公司不能发售产品")+"\n      ")])],1)],1)],1)},[],!1,null,null,"02c6ba2b").exports,V={name:"RoleShow",validate:({params:t})=>/^\d+$/.test(t.id),components:{CreateRoleForm:h.a,CommentMain:_.a,TabContainer:m.a,IdolDealBtn:y,StarIdolBtn:$,IdolOwnerList:C,IdolMarketPriceDraft:j,CreatePriceMarketDraft:O,ChangeIdolProfile:T,IdolStockChart:M,IdolProductOrderList:H,IdolProductArea:W,"el-collapse":c.a,"el-collapse-item":o.a},props:{id:{type:String,required:!0}},data:()=>({role:null,bangumi:null,share_data:null,collapsed:!0,activeName:""}),computed:{pages(){const t=[{label:"产品区"},{label:"留言板"},{label:"董事会"},{label:"大事记"},{label:"采购表"}];return(this.isBoss||this.bangumi.is_master)&&t.push({label:"信息变更"}),t},computedIdolMoney(){const t=+this.role.market_price,e=+this.role.star_count,r=+this.role.total_income,n=+this.role.total_pay;return parseFloat(t-e+r-n).toFixed(2)},computedHtmlIntro(){return this.role.intro.replace(/\n/g,"<br>")},currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},isBoss(){return!!this.role.boss&&this.role.boss.id===this.currentUserId},hasLimited(){return"0.00"!==this.role.max_stock_count},hasBuyStock(){return"0.00"!==this.role.has_star}},asyncData({app:t,store:e,params:r,error:n}){const{id:o}=r;return Object(d.l)(t,{id:o}).then(data=>{const{bangumi:t}=data;return e.commit("social/SET_STATE",{type:"bangumi",id:t.id,data:{follow:t.followed}}),{...data}}).catch(t=>{n({statusCode:t.statusCode,message:t.message})})},async fetch({store:t,params:e,query:r}){await t.dispatch("comment/getMainComments",{id:e.id,type:"role",seeReplyId:r["comment-id"]})},head(){return{title:this.role.name}},methods:{handleStarCallback({count:t,amount:e}){parseFloat(this.role.has_star)||(this.role.fans_count++,20===this.role.fans_count&&(this.role.company_state=1)),this.role.boss&&this.currentUserId===this.role.boss.id&&(this.role.boss.score+=t),this.role.market_price=parseFloat(parseFloat(this.role.market_price)+e).toFixed(2),this.role.has_star=parseFloat(parseFloat(this.role.has_star)+t).toFixed(2),this.role.star_count=parseFloat(parseFloat(this.role.star_count)+t).toFixed(2),this.$toast.success(`当前持股：${this.role.has_star}`)},cartoonRoleEditSuccess(){this.$toast.success("编辑成功"),window.location.reload()},handleTabSwitch(t){0===t&&this.$store.dispatch("flow/initData",{func:"getIdolProducts",type:"lastId",sort:"news",id:this.id}),2===t&&this.$store.dispatch("flow/initData",{func:"virtualIdolOwners",type:"seenIds",sort:"biggest",id:this.id}),3===t&&this.$store.dispatch("flow/initData",{func:"getIdolDraftList",type:"page",sort:"new",id:this.id}),4===t&&this.$store.dispatch("flow/initData",{func:"getIdolProductOrders",type:"page",sort:"news",id:this.id})}}};var X=Object(v.a)(V,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"role-show"}},[r("v-header"),t._ssrNode(" "),r("v-layout",[t.role.has_market_price_draft?r("div",[r("p",{staticClass:"sub-title"},[t._v("\n        重要提醒\n      ")]),t._v(" "),t.role.market_price_draft_voted?r("el-alert",{attrs:{closable:!1,description:"你已投「"+(t.role.market_price_draft_voted>0?"同意":"反对")+"」票",title:"正在召开股东大会",type:"info"}}):r("el-alert",{attrs:{closable:!1,title:"正在召开股东大会",type:"warning",description:"股东大会召开中，请全体股东到本页面「大事记」一栏进行会议投票"}}),t._v(" "),r("br")],1):t._e(),t._v(" "),r("div",{staticClass:"intro clearfix"},[r("p",{staticClass:"sub-title"},[t._v("\n        "+t._s(t.role.name)+"\n      ")]),t._v(" "),r("div",{staticClass:"avatar-wrap"},[r("img",{staticClass:"avatar",attrs:{src:t.$resize(t.role.avatar,{width:360})}}),t._v(" "),r("star-idol-btn",{attrs:{id:t.id,price:t.role.stock_price,max:+t.role.max_stock_count,buyed:+t.role.star_count,idol:t.role},on:{success:t.handleStarCallback}}),t._v(" "),r("idol-deal-btn",{attrs:{id:t.id,name:t.role.name,count:t.role.has_star,price:t.role.stock_price,locked:t.role.is_locked,state:t.role.company_state}})],1),t._v(" "),r("div",{staticClass:"info"},[t.collapsed?r("p",{staticClass:"summary collapsed"},[r("strong",[t._v("简介：")]),t._v(t._s(t.role.intro.substr(0,30))+"\n          "),r("button",{on:{click:function(e){t.collapsed=!1}}},[t._v("\n            全文\n          ")])]):r("div",{staticClass:"summary"},[r("strong",[t._v("简介：")]),t._v(" "),r("p",{domProps:{innerHTML:t._s(t.computedHtmlIntro)}}),t._v(" "),r("button",{on:{click:function(e){t.collapsed=!0}}},[t._v("\n            收起\n          ")])]),t._v(" "),r("strong",[t._v("股市行情：")]),t._v(" "),r("idol-stock-chart",{attrs:{idol:t.role}})],1)]),t._v(" "),t.role.boss?r("div",{staticClass:"lover"},[r("p",{staticClass:"sub-title"},[t._v("\n        大股东\n      ")]),t._v(" "),r("a",{staticClass:"user",attrs:{href:t.$alias.user(t.role.boss.zone),target:"_blank"}},[r("div",{staticClass:"avatar"},[r("img",{attrs:{src:t.$resize(t.role.boss.avatar,{width:80})}})]),t._v(" "),r("span",{domProps:{textContent:t._s(t.role.boss.nickname)}})]),t._v(" "),r("span",[t._v("："+t._s(t.role.lover_words||"TA还什么都没说！"))])]):t._e(),t._v(" "),t.role.manager?r("div",{staticClass:"lover"},[r("p",{staticClass:"sub-title"},[t._v("\n        经纪人\n      ")]),t._v(" "),r("a",{staticClass:"user",attrs:{href:t.$alias.user(t.role.manager.zone),target:"_blank"}},[r("div",{staticClass:"avatar"},[r("img",{attrs:{src:t.$resize(t.role.manager.avatar,{width:80})}})]),t._v(" "),r("span",{domProps:{textContent:t._s(t.role.manager.nickname)}})])]):t._e(),t._v(" "),t.role.company_state?r("div",{staticClass:"lover"},[r("p",{staticClass:"sub-title"},[t._v("\n        可支配资产\n      ")]),t._v(" "),r("span",[t._v("￥"+t._s(t.computedIdolMoney))])]):t._e(),t._v(" "),r("div",[r("p",{staticClass:"sub-title"},[t._v("\n        应援群\n      ")]),t._v(" "),r("div",{staticClass:"coin"},[r("p",[r("strong",[t._v("QQ群号：")]),t._v(t._s(t.role.qq_group||"106402736"))]),t._v(" "),r("br")])]),t._v(" "),r("tab-container",{attrs:{list:t.pages,route:!1,def:"1"},on:{change:t.handleTabSwitch}},[r("template",{slot:"0"},[r("idol-product-area",{attrs:{"idol-id":t.id,state:t.role.company_state}})],1),t._v(" "),r("template",{slot:"1"},[r("comment-main",{attrs:{id:t.id,"master-id":1,"show-header":!1,type:"role"}})],1),t._v(" "),r("template",{slot:"2"},[r("idol-owner-list",{attrs:{id:t.id,name:t.role.name,star:t.role.star_count}})],1),t._v(" "),r("template",{slot:"3"},[r("idol-market-price-draft",{attrs:{"is-boss":t.isBoss,idol:t.role}})],1),t._v(" "),r("template",{slot:"4"},[r("idol-product-order-list",{attrs:{"idol-id":t.id}})],1),t._v(" "),r("template",{slot:"5"},[t.isBoss?[r("el-collapse",{attrs:{accordion:""},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[r("el-collapse-item",{attrs:{name:"0"}},[r("p",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[t._v("\n                信息修改\n              ")]),t._v(" "),r("change-idol-profile",{attrs:{idol:t.role}})],1),t._v(" "),r("el-collapse-item",{attrs:{name:"1"}},[r("p",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[t._v("\n                股权变更\n              ")]),t._v(" "),r("create-price-market-draft",{attrs:{role:t.role}})],1)],1)]:t._e(),t._v(" "),t.bangumi.is_master?r("create-role-form",{attrs:{role:t.role,"bangumi-id":t.bangumi.id},on:{success:t.cartoonRoleEditSuccess}}):t._e()],2)],2),t._v(" "),r("template",{slot:"aside"},[r("div",{staticClass:"invite-code"},[r("h2",{staticClass:"sub-title"},[t._v("\n          邀请链接\n        ")]),t._v(" "),r("button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:t.share_data.link,expression:"share_data.link"}],on:{success:function(e){return t.$toast.success("复制成功~快去发送给好友吧")}}},[t._v("\n          点击邀请朋友炒股\n        ")]),t._v(" "),r("p",[t._v("使用你分享的链接注册，你们都能获得团子奖励")])]),t._v(" "),r("div",{staticClass:"bangumi"},[r("p",{staticClass:"sub-title"},[t._v("\n          所属番剧\n        ")]),t._v(" "),r("bangumi-panel",{attrs:{id:t.bangumi.id,name:t.bangumi.name,avatar:t.bangumi.avatar,summary:t.bangumi.summary}})],1)])],2)],2)},[],!1,function(t){var e=r(473);e.__inject__&&e.__inject__(t)},null,"2e6ead17");e.default=X.exports}};
//# sourceMappingURL=_id.chunk.cdc1e3bd.js.map